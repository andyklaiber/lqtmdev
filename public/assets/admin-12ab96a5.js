import{_ as v,h as b,r as f,o as r,c as l,t as u,e as g,a as c,w as y,b as t,R as I,f as C,n as w,F as $,p as le,g as ie,k as x,x as ce,y as se,T as de,i as _,j as k,z as F,d as S,A as ae,B as M,l as ue,m as he,q as me,s as pe,u as _e,v as fe}from"./main-d2ef9e6b.js";const ye={props:["message"],data(){return{errorMsg:[""]}},methods:{login(e){const{email:s,password:d}=e;return b.post("/api/auth/login",{email:s,password:d}).then(h=>{console.log(h),this.$emit("login"),this.$router.push({name:"races"})}).catch(h=>{h.response.status===401&&(this.errorMsg=["Invalid credentials, please try again"]),console.error(h)})}}},ge={class:"form-signin w-100 m-auto"},be={key:0},ve=t("h1",{class:"h3 mb-3 fw-normal"},"Sign in:",-1);function Ce(e,s,d,h,a,n){const o=f("FormKit");return r(),l("main",ge,[d.message?(r(),l("h3",be,u(d.message),1)):g("",!0),ve,c(o,{type:"form",onSubmit:n.login,errors:a.errorMsg},{default:y(()=>[c(o,{type:"email",name:"email",label:"Email address",validation:"","validation-visibility":"live"}),c(o,{type:"password",name:"password",label:"Password",validation:"required"})]),_:1},8,["onSubmit","errors"])])}const De=v(ye,[["render",Ce]]);const $e={emits:["logout"],components:{RouterView:I},data(){return{count:0}},computed:{}},oe=e=>(le("data-v-6a439c7e"),e=e(),ie(),e),ke={class:"navbar navbar-expand-md navbar-dark bg-dark fixed-top"},Re={class:"container-fluid"},we=oe(()=>t("a",{class:"navbar-brand",href:"/"},"Signup.bike Admin",-1)),xe=oe(()=>t("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarsExample04","aria-controls":"navbarsExample04","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),Se={class:"collapse navbar-collapse",id:"navbarsExample04"},Ee={class:"navbar-nav me-auto mb-2 mb-md-0"},Le={class:"nav-item"},Pe={class:"nav-item"},Ne={class:"nav-item"},Ve={class:"nav-item"},Ie={class:"container-fluid"};function Fe(e,s,d,h,a,n){const o=f("RouterLink"),m=f("RouterView");return r(),l($,null,[t("nav",ke,[t("div",Re,[we,xe,t("div",Se,[t("ul",Ee,[t("li",Le,[c(o,{class:w(["nav-link",{active:e.$route.name=="races"}]),to:{name:"races"}},{default:y(()=>[C(" Races ")]),_:1},8,["class"])]),t("li",Pe,[c(o,{class:w(["nav-link",{active:e.$route.name=="payments"}]),to:{name:"payments"}},{default:y(()=>[C(" Payments ")]),_:1},8,["class"])]),t("li",Ne,[c(o,{class:w(["nav-link",{active:e.$route.name=="results"}]),to:{name:"results"}},{default:y(()=>[C(" Results ")]),_:1},8,["class"])]),t("li",Ve,[c(o,{class:w(["nav-link",{active:e.$route.name=="series-results"}]),to:{name:"series-results"}},{default:y(()=>[C(" Series Points ")]),_:1},8,["class"])])]),t("button",{type:"button",class:"btn btn-secondary",onClick:s[0]||(s[0]=p=>e.$emit("logout"))},"Logout")])])]),t("body",null,[t("div",Ie,[c(m)])])],64)}const Me=v($e,[["render",Fe],["__scopeId","data-v-6a439c7e"]]);const Oe={components:{LoginComponent:De,Manage:Me},data(){return{showLogin:!1,loginText:""}},created(){this.checkAuth()},methods:{hideLogin(){this.showLogin=!1},checkAuth(){if(console.log(this.$route.path),this.$route.path=="/login/")this.showLogin=!0;else return b.post("/api/auth/login",{}).then(e=>{console.log(e),this.showLogin=!1,!this.$route.path&&this.$router.push({name:"races"})}).catch(e=>{if(e.response.status===401)return this.showLogin=!0;console.error(e)})},logout(){return b.get("/api/auth/logout").then(e=>{console.log(e),this.showLogin=!0,this.loginText="You are logged out."})}}},Ue={key:0},Te={class:"container"},Ke={key:1};function Be(e,s,d,h,a,n){const o=f("LoginComponent"),m=f("Manage");return a.showLogin?(r(),l("div",Ue,[t("div",Te,[c(o,{onLogin:n.hideLogin,message:a.loginText},null,8,["onLogin","message"])])])):(r(),l("div",Ke,[c(m,{onLogout:n.logout},null,8,["onLogout"])]))}const Ae=v(Oe,[["render",Be]]);const je={props:{show:Boolean}},qe={key:0,class:"modal-mask"},ze={class:"modal-wrapper"},He={class:"modal-body"},Ye={class:"modal-footer"};function Ge(e,s,d,h,a,n){return r(),x(de,{name:"modal"},{default:y(()=>[d.show?(r(),l("div",qe,[t("div",ze,[t("div",{class:"modal-container",onKeydown:s[1]||(s[1]=ce(o=>e.$emit("close"),["esc"])),tabIndex:"0"},[t("div",He,[se(e.$slots,"body",{},()=>[C("default body")])]),t("div",Ye,[se(e.$slots,"footer",{},()=>[t("button",{class:"btn btn-sm btn-danger modal-default-button",onClick:s[0]||(s[0]=o=>e.$emit("close"))},"Cancel")])])],32)])])):g("",!0)]),_:3})}const O=v(je,[["render",Ge]]),We={props:["paymentData","races","formMode"],data(){return{formError:[],formInputData:{},target:""}},mounted(){console.log(this.races),this.target=this.races[0]},computed:{raceOptions(){let e=this.races;return delete e[this.paymentData.regData.raceid],e}},methods:{async moveReg(e){return console.log(e),console.log(this.target),b.put("/api/payments/move-reg",{},{params:{paymentId:this.paymentData._id,raceId:this.target}}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})},async deleteReg(e){return console.log(e),console.log(this.target),b.delete(`/api/racers/race/${this.target}`,{params:{paymentId:this.paymentData._id}}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}}},Ze=t("div",{class:"modal-header"},[t("h5",null," Edit Payment ")],-1);function Je(e,s,d,h,a,n){const o=f("FormKit");return r(),l($,null,[Ze,t("div",null,[C(" Move This reg to Event: "),c(o,{type:"select",label:"Select an Event:",placeHolder:"Select race to transfer to",name:"selectedRace",modelValue:a.target,"onUpdate:modelValue":s[0]||(s[0]=m=>a.target=m),options:n.raceOptions},null,8,["modelValue","options"]),t("div",{class:"btn btn-sm btn-primary",onClick:s[1]||(s[1]=m=>n.moveReg())},"Transfer")]),t("div",null,[C(" Delete registration "),t("div",{class:"btn btn-sm btn-primary",onClick:s[2]||(s[2]=m=>n.deleteReg())},"Delete!")])],64)}const Qe=v(We,[["render",Je]]);const Xe={components:{ModalComponent:O,EditPaymentComponent:Qe},data(){return{loading:!1,error:null,races:[],filterKey:"",filterPayStatus:"all",filterEvent:!1,filterPaytype:"all",payments:[],selectedRaceId:"",showModal:!1}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},watch:{selectedRaceId:{handler(e){this.getPaymentsForRace(this.selectedRaceId)},immediate:!0}},methods:{dollas(e){return _.isNumber(e)?parseFloat(e/100).toLocaleString("en-US",{style:"currency",currency:"USD"}):""},fetchData(){if(this.error=null,this.loading=!0,this.$route)return b("/api/races/").then(e=>{this.races=e.data,this.races.length>0&&(this.selectedRaceId=this.races[0].raceid),this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},getPaymentsForRace(e){e&&b(`/api/payments/${e}`).then(s=>{this.payments=s.data,this.loading=!1}).catch(s=>{this.loading=!1,this.error=s.toString(),console.error(s)})},editPayment(e){let s=_.clone(_.find(this.payments,{_id:e}));s?(console.log("payment Data:"),console.log(s),this.paymentToEdit=s,this.paymentFormMode="edit",this.showModal=!0):alert("no payment id found for racer")},closeModal(){this.showModal=!1}},computed:{loaded(){return!!this.payments},raceSelectOptions(){let e={};return _.each(this.races,({raceid:s,displayName:d})=>e[s]=d),e},seriesRaces(){let e=_.find(this.races,{raceid:this.selectedRaceId});if(console.log("race data"),console.log(e),!e||!e.series)return[];console.log("series races"),console.log();let s={};return _.each(_.filter(this.races,{series:e.series}),({raceid:d,displayName:h})=>s[d]=h),s},filterPayStatusOptions(){return{all:"All",unpaid:"unpaid",paid:"paid"}},filterPayTypeOptions(){return{all:"All",season:"Season",single:"Single"}},filteredPayments(){const e=this.filterKey&&this.filterKey.toLowerCase();return this.payments&&(e.length||this.filterPayStatus!=="all"||this.filterPaytype!=="all")?_.filter(this.payments,s=>{var d;return this.filterPayStatus!=="all"&&this.filterPayStatus!==s.status||this.filterPaytype!=="all"&&((d=s.regData)==null?void 0:d.paytype)!==this.filterPaytype?!1:["first_name","last_name"].some(h=>String(s.regData[h]).toLowerCase().indexOf(e)>-1)}):this.payments}}},et={key:0,class:"loading"},tt={key:1},st={key:0,class:"error"},at={key:1},ot={class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},rt={class:"btn-toolbar mb-2 mb-md-0"},nt={class:"btn-toolbar mb-2 mb-md-0"},lt={class:"btn-toolbar mb-2 mb-md-0"},it={class:"btn-toolbar mb-2 mb-md-0"},ct=t("h2",null,"Payments",-1),dt={class:"table-responsive"},ut={class:"table table-striped table-hover table-sm"},ht=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Status"),t("th",{scope:"col"},"name"),t("th",{scope:"col"},"Reg Email"),t("th",{scope:"col"},"Race"),t("th",{scope:"col"},"Paytype")])],-1),mt=["onClick"],pt={key:2},_t=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading payments...")],-1),ft=[_t];function yt(e,s,d,h,a,n){const o=f("FormKit"),m=f("EditPaymentComponent"),p=f("modal-component");return a.loading?(r(),l("div",et,"Loading...")):(r(),l("div",tt,[a.error?(r(),l("div",st,u(a.error),1)):g("",!0),n.loaded?(r(),l("div",at,[t("div",ot,[t("div",rt,[c(o,{type:"select",label:"Select an Event:",name:"selectedRace",modelValue:a.selectedRaceId,"onUpdate:modelValue":s[0]||(s[0]=i=>a.selectedRaceId=i),options:n.raceSelectOptions},null,8,["modelValue","options"])]),t("div",nt,[c(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[1]||(s[1]=i=>a.filterKey=i)},null,8,["modelValue"])]),t("div",lt,[c(o,{type:"select",label:"Filter by Status:",name:"filterPayStatus",modelValue:a.filterPayStatus,"onUpdate:modelValue":s[2]||(s[2]=i=>a.filterPayStatus=i),default:"all",options:n.filterPayStatusOptions},null,8,["modelValue","options"])]),t("div",it,[c(o,{type:"select",label:"Filter by PayType:",name:"filterPaytype",modelValue:a.filterPaytype,"onUpdate:modelValue":s[3]||(s[3]=i=>a.filterPaytype=i),default:"all",options:n.filterPayTypeOptions},null,8,["modelValue","options"])])]),ct,t("div",dt,[t("table",ut,[ht,t("tbody",null,[(r(!0),l($,null,k(n.filteredPayments,(i,D)=>{var R;return r(),l("tr",{key:D},[t("td",null,u(i.status),1),t("td",null,u(i.regData.first_name+" "+i.regData.last_name),1),t("td",null,u(i.regData.email),1),t("td",null,u(i.regData.raceid),1),t("td",null,u(i.regData.paytype),1),t("td",null,u(n.dollas((R=i.stripePayment)==null?void 0:R.amount_total)),1),t("td",null,u(D),1),t("td",null,[i.status!=="unpaid"&&i.regData.paytype!="season"?(r(),l("div",{key:0,class:"btn btn-sm btn-secondary",onClick:N=>n.editPayment(i._id)},"Edit",8,mt)):g("",!0)])])}),128))])]),(r(),x(F,{to:"body"},[a.payments.length>0?(r(),x(p,{key:0,show:a.showModal,onClose:n.closeModal},{body:y(()=>[c(m,{races:n.seriesRaces,paymentData:e.paymentToEdit,formMode:e.paymentFormMode},null,8,["races","paymentData","formMode"])]),_:1},8,["show","onClose"])):g("",!0)]))])])):(r(),l("div",pt,ft))]))}const gt=v(Xe,[["render",yt]]);const bt={props:{data:Array,columns:Array,filterKey:String,editIdColumn:String},emits:["edit"],data(){return{sortKey:"",sortOrders:this.columns.reduce((e,s)=>(e[s]=1,e),{})}},computed:{filteredData(){const e=this.sortKey,s=this.filterKey&&this.filterKey.toLowerCase(),d=this.sortOrders[e]||1;let h=this.data;return s&&(h=h.filter(a=>Object.keys(a).some(n=>String(a[n]).toLowerCase().indexOf(s)>-1))),e&&(h=h.slice().sort((a,n)=>(a=a[e],n=n[e],(a===n?0:a>n?1:-1)*d))),h}},methods:{sortBy(e){this.sortKey=e,this.sortOrders[e]=this.sortOrders[e]*-1},capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}}},vt={class:"table-responsive"},Ct={key:0,class:"table table-striped table-sm"},Dt=["onClick"],$t={key:0},kt=["onClick"],Rt={key:1};function wt(e,s,d,h,a,n){return r(),l("div",vt,[n.filteredData.length?(r(),l("table",Ct,[t("thead",null,[t("tr",null,[(r(!0),l($,null,k(d.columns,o=>(r(),l("th",{onClick:m=>n.sortBy(o),class:w({active:a.sortKey==o})},[C(u(n.capitalize(o))+" ",1),t("span",{class:w(["arrow",a.sortOrders[o]>0?"asc":"dsc"])},null,2)],10,Dt))),256))])]),t("tbody",null,[(r(!0),l($,null,k(n.filteredData,o=>(r(),l("tr",null,[(r(!0),l($,null,k(d.columns,m=>(r(),l("td",null,u(o[m]),1))),256)),d.editIdColumn?(r(),l("td",$t,[t("div",{class:"btn btn-sm btn-outline-secondary",onClick:m=>e.$emit("edit",o[d.editIdColumn])},"edit",8,kt)])):g("",!0)]))),256))])])):(r(),l("p",Rt,"No data found."))])}const re=v(bt,[["render",wt]]);const xt={props:["racerData","categories","payments","formMode","series"],emits:["saved"],data(){return{birthdate:"",formError:[],submitted:!1,paymentType:"season",prevBibError:[],formInputData:{}}},mounted(){if(this.formMode==="create"){this.paymentType=this.racerData.paytype;return}(this.formMode==="edit"||this.formMode==="regcash")&&(this.formInputData=this.racerData),_.defer(()=>{document.querySelector("#bibNumber").focus()})},computed:{sortedCats(){let e={};return _.forEach(_.orderBy(this.categories,"disporder"),s=>{e[s.id]=s.catdispname}),e},paymentOptions(){let e={};return _.forEach(this.payments,s=>{e[s.type]=s.name}),e.cash="Cash Single Entry",e.volunteer="Volunteer Single Entry",e.season="Season Comp",e},racerAge(){if(this.birthdate){const e=S(),s=S(this.birthdate);return e.year()-s.year()}},unpaidReg(){return this.formMode==="create"?this.paymentType=="cash":this.paymentType=="cash"&&this.racerData.status=="unpaid"},paymentAmount(){if(this.racerData.paytype==="cash")return _.find(this.payments,{type:"single"}).amount}},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},findPrevBib(e){b.post(`/api/racers/bib/${e}`,{series:`${this.series}`}).then(({data:s})=>{if(console.log("prevbib"),console.log(s),s.paytype==="season"){this.prevBibError=["Racer is already registered for the whole season"];return}s.prevPaymentId=s.paymentId,delete s.paymentId,delete s.paymentReceived,delete s.raceid,this.formInputData=s,this.prevAge=s.racerAge}).catch(({response:s})=>{console.dir(s),s.status==404&&(this.prevBibError=[s.data.message])})},onPrevBibChange(e){e?this.findPrevBib(e):(this.prevBibError=[],this.prevAge=null)},async submitHandler(e){console.log(e);let s;if(this.formMode==="create"||this.formMode==="regcash"){let d=this.paymentAmount;(e.paytype=="season"||e.paytype=="volunteer")&&(d=0,e.compedEntry=!0),s=b.post("/api/payments/register",{...e,paymentAmount:d},{params:{paymentId:e.paymentId,raceId:this.$route.params.raceid}})}else delete e.status,s=b.patch(`/api/racers/race/${this.$route.params.raceid}`,e,{params:{paymentId:this.racerData.paymentId}});return await s.then(d=>{if(d.data)return this.submitted=!0,console.log("response data"),console.log(d.data),new Promise(h=>setTimeout(()=>{this.$emit("saved"),h()},100))}).catch(d=>{this.formError=["Error submitting request"],console.log(d)})}}},St={class:"modal-header"},Et={class:"edit-racer-form"},Lt={class:"double"},Pt={class:"double"},Nt={class:"double"},Vt={key:0},It=t("p",{class:"text-danger h4"},"Cash Payment Required",-1);function Ft(e,s,d,h,a,n){const o=f("FormKit");return r(),l($,null,[t("div",St,[t("h5",null,u(d.racerData.status==="unpaid"?"Register Racer":"Edit Racer Data"),1)]),t("div",Et,[d.formMode=="create"?(r(),x(o,{key:0,type:"number",name:"bibNumber",label:"Bib Number:",help:"Enter racer's bib number from a previous race",delay:1500,onInput:n.onPrevBibChange,errors:a.prevBibError},null,8,["onInput","errors"])):g("",!0),c(o,{type:"form",id:"admin-registration",modelValue:a.formInputData,"onUpdate:modelValue":s[1]||(s[1]=m=>a.formInputData=m),"form-class":a.submitted?"hide":"show",errors:a.formError,"submit-label":"Save",onSubmit:n.submitHandler},{default:y(()=>[t("div",Lt,[c(o,{type:"text",name:"first_name",label:"First name",validation:"required"}),c(o,{type:"text",name:"last_name",label:"Last name",validation:"required"})]),t("div",Pt,[c(o,{type:"email",name:"email",label:"Email",validation:"email"}),c(o,{type:"text",name:"sponsor",label:"Team or Sponsor"})]),c(o,{type:"text",name:"racerAge",label:"Racer Age",help:"age on dec 31"}),t("div",Nt,[c(o,{type:"select",id:"category",label:"Race Category:",placeholder:"Select a category",name:"category",options:n.sortedCats,validation:"required","validation-visibility":"dirty","validation-messages":{is:"You must select a race category"}},null,8,["options"]),c(o,{type:"select",id:"paytype",label:"Payment Type:",name:"paytype",options:n.paymentOptions,modelValue:a.paymentType,"onUpdate:modelValue":s[0]||(s[0]=m=>a.paymentType=m),validation:"required","validation-visibility":"dirty","validation-messages":{is:"You must select a Payment Type"}},null,8,["options","modelValue"])]),c(o,{id:"bibNumber",type:"text",name:"bibNumber",label:"Bib Number"}),n.unpaidReg?(r(),l("div",Vt,[It,c(o,{type:"checkbox",label:`I Collected ${n.dollas(n.paymentAmount)} from the racer`,name:"paymentReceived",validation:"required"},null,8,["label"])])):g("",!0)]),_:1},8,["modelValue","form-class","errors","onSubmit"])])],64)}const ne=v(xt,[["render",Ft]]);const Mt={components:{ModalComponent:O,RacerFormComponent:ne,Grid:re},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},data:{},racerToEdit:null,racerFormMode:"edit",showModal:!1,filterKey:"",filterUnpaid:!1,filterNoBib:!1,filterCats:"all"}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){this.error=null,this.loading=!0,this.$route.params.raceid&&b(`/api/racers/race/${this.$route.params.raceid}`).then(e=>{this.data=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},catName(e){let s=_.find(this.data.regCategories,{id:e});return s?s.catdispname:""},createReg(){this.racerToEdit={paytype:"cash",status:"unpaid",raceid:this.$route.params.raceid},this.racerFormMode="create",this.showModal=!0},regCash(e){let s=_.clone(_.find(this.data.registeredRacers,{paymentId:e}));s?(console.log("racerData:"),console.log(s),this.racerToEdit=s,this.racerFormMode="regcash",this.showModal=!0):alert("no payment id found for racer")},editRacer(e){let s=_.clone(_.find(this.data.registeredRacers,{paymentId:e}));s?(console.log("racerData:"),console.log(s),this.racerToEdit=s,this.racerFormMode="edit",this.showModal=!0):alert("no payment id found for racer")},racerUpdated(){this.racerToEdit=null,this.showModal=!1,this.fetchData()},capitalize(e){return _.capitalize(e)},closeModal(){this.showModal=!1,_.defer(()=>{document.querySelector("#racerFilterTxtInput").focus()})},resetFilters(){this.filterKey="",this.filterUnpaid=!1,this.filterNoBib=!1,this.filterCats="all"},optionalPurchases(e){if(!e)return"";let s="";return e.tshirt&&(s="shirt: "+e["tshirt-option"]),e.bottle&&(s+=" + Bottle"),s}},computed:{loaded(){return!!this.data},sortedCats(){let e={all:"All Categories"};return _.forEach(_.orderBy(this.data.regCategories,"disporder"),s=>{e[s.id]=s.catdispname}),e},filteredRacers(){const e=this.filterKey&&this.filterKey.toLowerCase();let s=this.data.registeredRacers;return(e.length||this.filterUnpaid||this.filterCats!=="all"||this.filterNoBib)&&(s=s.filter(d=>this.filterUnpaid&&d.status!=="unpaid"||this.filterNoBib&&d.bibNumber||this.filterCats!="all"&&d.category!=this.filterCats?!1:["first_name","last_name","bibNumber"].some(h=>String(d[h]).toLowerCase().indexOf(e)>-1))),_.sortBy(s,[function(d){return d.last_name.toLowerCase()}])}}},Ot={key:0,class:"loading"},Ut={key:1},Tt={key:0,class:"error"},Kt={key:1,class:"container-fluid"},Bt={class:"d-flex flex-row justify-content-center"},At={class:"p-2"},jt={class:"racer-controls d-flex flex-row justify-content-between flex-wrap align-items-top pb-2 mb-3 border-bottom"},qt={class:"p-2"},zt={class:"flex-grow-1 p-2"},Ht={class:"d-flex flex-row search-checks"},Yt={class:"d-flex flex-grow-1 justify-content-between p-2 pt-4"},Gt={class:"table-responsive"},Wt={class:"table table-striped table-sm"},Zt=t("th",{scope:"col"},"First Name",-1),Jt=t("th",{scope:"col"},"Last Name",-1),Qt=t("th",{scope:"col"},"Category",-1),Xt=t("th",{scope:"col"},"Bib Number",-1),es=t("th",{scope:"col"},"Purchases",-1),ts=t("th",{scope:"col"},"Paytype",-1),ss=t("th",{scope:"col"},"Payment Status",-1),as={scope:"col"},os=["onClick"],rs=["onClick"],ns={key:2},ls=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Race not available for registration...")],-1),is=[ls];function cs(e,s,d,h,a,n){const o=f("FormKit"),m=f("RacerFormComponent"),p=f("modal-component");return a.loading?(r(),l("div",Ot,"Loading...")):(r(),l("div",Ut,[a.error?(r(),l("div",Tt,u(a.error),1)):g("",!0),n.loaded?(r(),l("div",Kt,[t("div",Bt,[t("div",At,[t("h3",null,u(a.data.displayName),1)])]),t("div",jt,[t("div",qt,[c(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last or bib number",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[0]||(s[0]=i=>a.filterKey=i)},null,8,["modelValue"])]),t("div",zt,[c(o,{type:"select",name:"categories",label:"Filter by Category",options:n.sortedCats,modelValue:a.filterCats,"onUpdate:modelValue":s[1]||(s[1]=i=>a.filterCats=i)},null,8,["options","modelValue"]),t("div",Ht,[c(o,{type:"checkbox",name:"unpaid",label:"Unpaid Only",modelValue:a.filterUnpaid,"onUpdate:modelValue":s[2]||(s[2]=i=>a.filterUnpaid=i)},null,8,["modelValue"]),c(o,{type:"checkbox",name:"noBib",label:"No Bib Only",modelValue:a.filterNoBib,"onUpdate:modelValue":s[3]||(s[3]=i=>a.filterNoBib=i)},null,8,["modelValue"])])]),t("div",Yt,[t("a",{class:"btn btn-primary align-self-start",onClick:s[4]||(s[4]=(...i)=>n.resetFilters&&n.resetFilters(...i))},"Reset Filters"),t("div",{class:"btn btn-md btn-success align-self-start",onClick:s[5]||(s[5]=i=>n.createReg())},"Add New Registration")])]),t("div",Gt,[t("table",Wt,[t("thead",null,[t("tr",null,[Zt,Jt,Qt,Xt,es,ts,ss,t("th",as,[t("strong",null,u(n.filteredRacers.length)+" Found",1)])])]),t("tbody",null,[(r(!0),l($,null,k(n.filteredRacers,(i,D)=>(r(),l("tr",{key:D},[t("td",null,u(i.first_name),1),t("td",null,u(i.last_name),1),t("td",null,u(n.catName(i.category)),1),t("td",null,u(i.bibNumber),1),t("td",null,u(n.optionalPurchases(i.optionalPurchases)),1),t("td",null,u(i.paytype),1),t("td",{class:w({"text-success":i.status!=="unpaid","text-danger":i.status==="unpaid"})},u(n.capitalize(i.status)),3),t("td",null,[i.status!=="unpaid"?(r(),l("div",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:R=>n.editRacer(i.paymentId)},u("edit"),8,os)):g("",!0),i.status==="unpaid"?(r(),l("div",{key:1,class:"btn btn-sm btn-outline-secondary",onClick:R=>n.regCash(i.paymentId)},u("Register"),8,rs)):g("",!0)])]))),128))])]),(r(),x(F,{to:"body"},[c(p,{show:a.showModal,onClose:n.closeModal},{body:y(()=>[c(m,{onSaved:n.racerUpdated,racerData:a.racerToEdit,categories:a.data.regCategories,payments:a.data.paymentOptions,formMode:a.racerFormMode,series:a.data.series},null,8,["onSaved","racerData","categories","payments","formMode","series"])]),_:1},8,["show","onClose"])]))])])):(r(),l("div",ns,is))]))}const ds=v(Mt,[["render",cs]]);const us={components:{},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},raceData:{}}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){if(this.error=null,this.loading=!0,this.$route.params.raceid)return b(`/api/races/${this.$route.params.raceid}`).then(e=>{this.raceData=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},editCategories(){},editPaytypes(){},async saveRaceData(e){await b.patch(`/api/races/${this.$route.params.raceid}`,this.formInputData).then(s=>{if(s.data)return console.log(s.data),this.fetchData()}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}},computed:{sortedCats(){return _.orderBy(this.raceData.regCategories,"disporder")},loaded(){return!!this.raceData},eventDate(){return S(this.raceData.eventDate).format("YYYY-MM-DDTHH:mm")},regOpenDate(){return S(this.raceData.regOpenDate).format("YYYY-MM-DDTHH:mm")},timeToOpen(){var e;return S().to((e=this.raceData.eventDetails)==null?void 0:e.regOpenDate)},timeToClose(){var e;return S().to((e=this.raceData.eventDetails)==null?void 0:e.regCloseDate)},paymentOptions(){let e={};return _.forEach(this.raceData.paymentOptions,s=>{e[s.type]=s.name}),e}}},hs={class:"container"},ms={key:0,class:"loading"},ps={key:1},_s={key:0,class:"error"},fs={key:1},ys={class:"my-3"},gs=["href"],bs={class:"my-3"},vs=["href"],Cs={class:"row"},Ds={class:"col-md-6"},$s={class:"col-md-6"},ks={class:"col-md mb-3"},Rs=t("h5",null,"Categories",-1),ws={class:"row g-2 px-4 gx-4 border bg-light"},xs={class:"my-1"},Ss={key:0},Es={class:"col-md mb-3"},Ls=t("h5",null,"Payment Options",-1),Ps={class:"row g-2 px-4 gx-4 border bg-light"},Ns={class:"my-1"},Vs={class:"col-md mb-3"},Is=t("h5",null,"Coupons",-1),Fs={class:"row g-2 px-4 gx-4 border bg-light"},Ms={class:"my-1"};function Os(e,s,d,h,a,n){const o=f("FormKit");return r(),l("div",hs,[a.loading?(r(),l("div",ms,"Loading...")):(r(),l("div",ps,[a.error?(r(),l("div",_s,u(a.error),1)):g("",!0),(r(),l("div",fs,[t("div",ys,[t("a",{href:`/#/register/${a.raceData.raceid}`},"View Reg Form",8,gs)]),t("div",bs,[t("a",{href:`/#/roster/${a.raceData.raceid}`},"View Roster",8,vs)]),t("div",Cs,[t("div",Ds,[c(o,{type:"form",errors:a.formError,id:"race-settings",onSubmit:n.saveRaceData,"submit-label":"Save",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=m=>a.formInputData=m)},{default:y(()=>{var m,p,i,D,R,N,K;return[c(o,{value:(m=a.raceData)==null?void 0:m.displayName,type:"text",name:"displayName",label:"Event Name"},null,8,["value"]),c(o,{value:n.eventDate,type:"datetime-local",name:"eventDate",label:"Date"},null,8,["value"]),c(o,{value:(p=a.raceData)==null?void 0:p.series,type:"text",name:"series",label:"Event Series Name"},null,8,["value"]),c(o,{type:"group",name:"eventDetails"},{default:y(()=>{var E,L,B,A,j,q,z,H,Y,G,W,Z,J,Q;return[c(o,{value:(L=(E=a.raceData)==null?void 0:E.eventDetails)==null?void 0:L.name,type:"text",name:"name",label:"Header Event Name"},null,8,["value"]),c(o,{value:(A=(B=a.raceData)==null?void 0:B.eventDetails)==null?void 0:A.formattedDates,type:"text",name:"formattedDates",label:"Header Formatted dates"},null,8,["value"]),c(o,{value:(q=(j=a.raceData)==null?void 0:j.eventDetails)==null?void 0:q.tagline,type:"text",name:"tagline",label:"Header tagline text"},null,8,["value"]),c(o,{value:(H=(z=a.raceData)==null?void 0:z.eventDetails)==null?void 0:H.regOpenDate,type:"datetime-local",name:"regOpenDate",label:"Registration Open Date"},null,8,["value"]),t("p",null,"Registration Opens "+u(n.timeToOpen),1),c(o,{value:(G=(Y=a.raceData)==null?void 0:Y.eventDetails)==null?void 0:G.regCloseDate,type:"datetime-local",name:"regCloseDate",label:"Registration Close Date"},null,8,["value"]),t("p",null,"Registration Closes "+u(n.timeToClose),1),c(o,{value:(Z=(W=a.raceData)==null?void 0:W.eventDetails)==null?void 0:Z.logoUrl,type:"text",name:"logoUrl",label:"Logo URL"},null,8,["value"]),c(o,{value:(Q=(J=a.raceData)==null?void 0:J.eventDetails)==null?void 0:Q.homepageUrl,type:"text",name:"homepageUrl",label:"Home Page URL"},null,8,["value"]),c(o,{type:"group",name:"facebookShare"},{default:y(()=>{var X,ee,te;return[c(o,{value:(te=(ee=(X=a.raceData)==null?void 0:X.eventDetails)==null?void 0:ee.facebookShare)==null?void 0:te.url,type:"text",name:"url",label:"FB Share URL"},null,8,["value"])]}),_:1})]}),_:1}),c(o,{type:"textarea",value:(i=a.raceData)==null?void 0:i.headerContent,"v-model":(D=a.raceData)==null?void 0:D.headerContent,label:"Extra content below header",name:"headerContent"},null,8,["value","v-model"]),c(o,{value:(R=a.raceData)==null?void 0:R.entryCountMax,type:"number",label:"Maximum Number of registrations",name:"entryCountMax"},null,8,["value"]),t("p",null,[t("h6",null,"Current Reg Count: "+u(a.raceData.entryCount),1)]),c(o,{value:(N=a.raceData)==null?void 0:N.showPaytypeOnRoster,type:"checkbox",label:"Show Payment Type as stages on roster",name:"showPaytypeOnRoster"},null,8,["value"]),c(o,{value:a.raceData.isTestData,type:"checkbox",label:"Use Test payment integrations",name:"isTestData"},null,8,["value"]),c(o,{value:a.raceData.couponsEnabled,type:"checkbox",label:"Enable Coupons",name:"couponsEnabled"},null,8,["value"]),c(o,{value:(K=a.raceData)==null?void 0:K.cashPaymentsEnabled,type:"checkbox",label:"Enable Cash payments on race day",name:"cashPaymentsEnabled"},null,8,["value"]),c(o,{type:"group",name:"stripeMeta"},{default:y(()=>{var E,L;return[c(o,{value:(L=(E=a.raceData)==null?void 0:E.stripeMeta)==null?void 0:L.accountId,type:"text",name:"accountId",label:"Stripe Integration Account ID"},null,8,["value"])]}),_:1}),c(o,{value:a.raceData.archived,type:"checkbox",label:"Archive Race (will not be visible in admin race list)",name:"archived"},null,8,["value"])]}),_:1},8,["errors","onSubmit","modelValue"])]),t("div",$s,[t("div",ks,[Rs,t("div",ws,[(r(!0),l($,null,k(n.sortedCats,m=>(r(),l("div",xs,[C(u(m.catdispname)+" ",1),m.sponsored?(r(),l("strong",Ss,"Sponsored")):g("",!0)]))),256))])]),c(o,{type:"button",onClick:n.editCategories},{default:y(()=>[C(" Edit Categories ")]),_:1},8,["onClick"]),t("div",Es,[Ls,t("div",Ps,[(r(!0),l($,null,k(a.raceData.paymentOptions,m=>(r(),l("div",Ns,u(m.name)+":"+u(`  ${n.dollas(m.amount)}`),1))),256))])]),c(o,{type:"button",onClick:n.editPaytypes},{default:y(()=>[C(" Edit Paytypes ")]),_:1},8,["onClick"]),t("div",Vs,[Is,t("div",Fs,[(r(!0),l($,null,k(a.raceData.coupons,m=>(r(),l("div",Ms,u(e.payOpt.name)+":"+u(`  ${n.dollas(e.payOpt.amount)}`),1))),256))])]),c(o,{type:"button",onClick:n.editPaytypes},{default:y(()=>[C(" Edit Paytypes ")]),_:1},8,["onClick"])])])]))]))])}const Us=v(us,[["render",Os]]);const Ts={components:{ModalComponent:O,RacerFormComponent:ne,Grid:re},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},data:{},racerToEdit:null,showModal:!1,filterKey:"",filterUnpaid:!1,filterNoBib:!1,filterCats:"all",filterSimilar:!0}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){this.error=null,this.loading=!0,this.$route.params.raceid&&this.$route.params.series&&b(`/api/racers/series/${this.$route.params.series}`).then(({data:e})=>{console.log(e),this.data={registeredRacers:e.racers,regCategories:e.regCategories,races:e.races},this.loading=!1,this.error=""}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)}),this.error="invalid URL"},catName(e){let s=_.find(this.data.regCategories,{id:e});return s?s.catdispname:""},createReg(){this.racerToEdit={paytype:"cash",status:"unpaid",raceid:this.$route.params.raceid},this.showModal=!0},editRacer(e){let s=_.clone(_.find(this.data.registeredRacers,{paymentId:e}));s?(this.racerToEdit=s,this.showModal=!0):alert("no payment id found for racer")},racerUpdated(){this.racerToEdit=null,this.showModal=!1,this.fetchData()},capitalize(e){return _.capitalize(e)},closeModal(){this.showModal=!1,_.defer(()=>{document.querySelector("#racerFilterTxtInput").focus()})},resetFilters(){this.filterKey="",this.filterUnpaid=!1,this.filterNoBib=!1,this.filterCats="all"}},computed:{loaded(){return!!this.data},sortedCats(){let e={all:"All Categories"};return _.forEach(_.orderBy(this.data.regCategories,"disporder"),s=>{e[s.id]=s.catdispname}),e},filteredRacers(){const e=this.filterKey&&this.filterKey.toLowerCase();let s=this.data.registeredRacers;if(this.filterSimilar){let d=[];return _.forEach(this.data.races,(h,a)=>{console.log(h);let n=_.filter(s,{raceid:h});_.forEach(n,(o,m)=>{_.forEach(_.filter(s,{raceid:this.data.races[a+1]}),p=>{(o.first_name.toLowerCase()===p.first_name.toLowerCase()||o.last_name.toLowerCase()===p.last_name.toLowerCase())&&(_.includes(d,o)||d.push(o),_.includes(d,p)||d.push(p))})})}),_.sortBy(d,[function(h){return h.last_name.toLowerCase()}])}return(e.length||this.filterUnpaid||this.filterCats!=="all"||this.filterNoBib)&&(s=s.filter(d=>this.filterUnpaid&&d.status!=="unpaid"||this.filterNoBib&&d.bibNumber||this.filterCats!="all"&&d.category!=this.filterCats?!1:["first_name","last_name","bibNumber"].some(h=>String(d[h]).toLowerCase().indexOf(e)>-1))),_.sortBy(s,[function(d){return d.last_name.toLowerCase()}])}}},Ks={key:0,class:"loading"},Bs={key:1},As={key:0,class:"error"},js={key:1,class:"container-fluid"},qs={class:"racer-controls d-flex flex-row justify-content-between flex-wrap align-items-top pt-3 pb-2 mb-3 p-2 border-bottom"},zs={class:"p-2"},Hs={class:"flex-grow-1 p-2"},Ys={class:"d-flex flex-row search-checks"},Gs={class:"d-flex flex-grow-1 justify-content-between pt-4"},Ws={class:"table-responsive"},Zs={class:"table table-striped table-sm"},Js=t("th",{scope:"col"},"First Name",-1),Qs=t("th",{scope:"col"},"Last Name",-1),Xs=t("th",{scope:"col"},"Email",-1),ea=t("th",{scope:"col"},"Category",-1),ta=t("th",{scope:"col"},"Bib Number",-1),sa=t("th",{scope:"col"},"Paytype",-1),aa=t("th",{scope:"col"},"EventName",-1),oa={scope:"col"},ra=["onClick"],na={key:2},la=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Race not available for registration...")],-1),ia=[la];function ca(e,s,d,h,a,n){const o=f("FormKit"),m=f("RacerFormComponent"),p=f("modal-component");return a.loading?(r(),l("div",Ks,"Loading...")):(r(),l("div",Bs,[a.error?(r(),l("div",As,u(a.error),1)):g("",!0),n.loaded?(r(),l("div",js,[t("div",qs,[t("div",zs,[c(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last or bib number",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[0]||(s[0]=i=>a.filterKey=i)},null,8,["modelValue"])]),t("div",Hs,[c(o,{type:"select",name:"categories",label:"Filter by Category",options:n.sortedCats,modelValue:a.filterCats,"onUpdate:modelValue":s[1]||(s[1]=i=>a.filterCats=i)},null,8,["options","modelValue"]),t("div",Ys,[c(o,{type:"checkbox",name:"unpaid",label:"Unpaid Only",modelValue:a.filterUnpaid,"onUpdate:modelValue":s[2]||(s[2]=i=>a.filterUnpaid=i)},null,8,["modelValue"]),c(o,{type:"checkbox",name:"noBib",label:"No Bib Only",modelValue:a.filterNoBib,"onUpdate:modelValue":s[3]||(s[3]=i=>a.filterNoBib=i)},null,8,["modelValue"]),c(o,{type:"checkbox",name:"duplicates",label:"Duplicates",modelValue:a.filterSimilar,"onUpdate:modelValue":s[4]||(s[4]=i=>a.filterSimilar=i)},null,8,["modelValue"])])]),t("div",Gs,[t("a",{class:"btn btn-primary align-self-start",onClick:s[5]||(s[5]=(...i)=>n.resetFilters&&n.resetFilters(...i))},"Reset Filters")])]),t("div",Ws,[t("table",Zs,[t("thead",null,[t("tr",null,[Js,Qs,Xs,ea,ta,sa,aa,t("th",oa,[t("strong",null,u(n.filteredRacers.length)+" Found",1)])])]),t("tbody",null,[(r(!0),l($,null,k(n.filteredRacers,(i,D)=>(r(),l("tr",{key:D},[t("td",null,u(i.first_name),1),t("td",null,u(i.last_name),1),t("td",null,u(i.email),1),t("td",null,u(n.catName(i.category)),1),t("td",null,u(i.bibNumber),1),t("td",null,u(i.paytype),1),t("td",null,u(i.eventDisplayName),1),t("td",null,[t("div",{class:"btn btn-sm btn-outline-secondary",onClick:R=>n.editRacer(i.paymentId)},u("edit"),8,ra)])]))),128))])]),(r(),x(F,{to:"body"},[c(p,{show:a.showModal,onClose:n.closeModal},{body:y(()=>[c(m,{onSaved:n.racerUpdated,racerData:a.racerToEdit,categories:a.data.regCategories,payments:a.data.paymentOptions,formMode:"edit",series:a.data.series},null,8,["onSaved","racerData","categories","payments","series"])]),_:1},8,["show","onClose"])]))])])):(r(),l("div",na,ia))]))}const da=v(Ts,[["render",ca]]),ua={props:["races"],components:{RouterView:I},data(){return{count:0}},computed:{}},ha={class:"container-fluid"},ma={class:"nav nav-tabs"},pa={class:"nav-item"},_a={class:"nav-item"};function fa(e,s,d,h,a,n){const o=f("RouterLink"),m=f("RouterView");return r(),l("div",ha,[t("ul",ma,[t("li",pa,[c(o,{class:w(["nav-link",{active:e.$route.name=="edit-race"}]),to:{name:"edit-race"}},{default:y(()=>[C(" Event Settings ")]),_:1},8,["class"])]),t("li",_a,[c(o,{class:w(["nav-link",{active:e.$route.name=="edit-racers"}]),to:{name:"edit-racers"}},{default:y(()=>[C(" Event Registrations ")]),_:1},8,["class"])])]),c(m)])}const ya=v(ua,[["render",fa]]),P={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var ga=["size","color"];function V(){return V=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(e[h]=d[h])}return e},V.apply(this,arguments)}function ba(e,s){if(e==null)return{};var d={},h=Object.keys(e),a,n;for(n=0;n<h.length;n++)a=h[n],!(s.indexOf(a)>=0)&&(d[a]=e[a]);return d}var va=function(s){return s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()},Ca=function(s,d){return function(h,a){var n=h.size,o=h.color,m=ba(h,ga),p=a.attrs;a.emit;var i=a.slots;return ae("svg",V({},P,{width:n||P.width,height:n||P.height,stroke:o||P.stroke},p,{class:["lucide","lucide-"+va(s),(p==null?void 0:p.class)||""]},m),[].concat(d.map(function(D){return ae.apply(void 0,D)}),i.default?[i.default()]:[]))}};const Da=Ca;var $a=Da("CheckIcon",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]);const U=$a;const ka={components:{RouterLink:M,Check:U},data(){return{loading:!1,error:null}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{fetchData(){if(this.error=null,this.loading=!0,this.$route)return b("/api/races/").then(e=>{this.raceData=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})}},computed:{loaded(){return!!this.raceData}}},Ra={key:0,class:"loading"},wa={key:1},xa={key:0,class:"error"},Sa={key:1},Ea=t("h2",null,"Active Races",-1),La={class:"table-responsive"},Pa={class:"table table-striped table-hover table-sm"},Na=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Name"),t("th",{scope:"col"},"series ID"),t("th",null,"Test Payments")])],-1),Va=["href"],Ia=["href"],Fa=["href"],Ma={key:2},Oa=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading races...")],-1),Ua=[Oa];function Ta(e,s,d,h,a,n){const o=f("RouterLink"),m=f("Check");return a.loading?(r(),l("div",Ra,"Loading...")):(r(),l("div",wa,[a.error?(r(),l("div",xa,u(a.error),1)):g("",!0),n.loaded?(r(),l("div",Sa,[Ea,t("div",La,[t("table",Pa,[Na,t("tbody",null,[(r(!0),l($,null,k(e.raceData,(p,i)=>(r(),l("tr",{key:i},[t("td",null,[c(o,{to:{name:"edit-racers",params:{raceid:p.raceid}}},{default:y(()=>[C(u(p.displayName),1)]),_:2},1032,["to"])]),t("td",null,u(p.series),1),t("td",null,[p.isTestData?(r(),x(m,{key:0,color:"orange"})):g("",!0)]),t("td",null,[t("a",{href:`/#/register/${p.raceid}`},"Goto Reg Form",8,Va)]),t("td",null,[t("a",{class:"btn btn-sm btn-secondary mx-1",href:`/api/racers/race/${p.raceid}/export-contact`},"Contact List",8,Ia),t("a",{class:"btn btn-sm btn-secondary mx-1",href:`/api/racers/race/${p.raceid}/export`},"export",8,Fa)])]))),128))])])])])):(r(),l("div",Ma,Ua))]))}const Ka=v(ka,[["render",Ta]]),Ba={components:{RouterView:I},data(){return{count:0}},computed:{}},Aa={class:"container-fluid"},ja=t("ul",{class:"nav nav-tabs"},null,-1);function qa(e,s,d,h,a,n){const o=f("RouterView");return r(),l("div",Aa,[ja,c(o)])}const za=v(Ba,[["render",qa]]);const Ha={components:{RouterLink:M,Check:U},data(){return{loading:!1,error:null}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{fetchData(){if(this.error=null,this.loading=!0,this.$route)return b("/api/results/").then(e=>{this.results=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})}},computed:{loaded(){return!!this.results}}},Ya={key:0,class:"loading"},Ga={key:1},Wa={key:0,class:"error"},Za={key:1},Ja=t("h2",null,"Race Result Uploads",-1),Qa={class:"table-responsive"},Xa={class:"table table-striped table-hover table-sm"},eo=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Event Name"),t("th",{scope:"col"},"Series Points Display Name"),t("th",{scope:"col"},"Formatted Date"),t("th",{scope:"col"},"series ID"),t("th",{scope:"col"},"Finalized")])],-1),to=["href"],so=t("td",null,null,-1),ao={key:2},oo=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading results...")],-1),ro=[oo];function no(e,s,d,h,a,n){const o=f("Check"),m=f("RouterLink");return a.loading?(r(),l("div",Ya,"Loading...")):(r(),l("div",Ga,[a.error?(r(),l("div",Wa,u(a.error),1)):g("",!0),n.loaded?(r(),l("div",Za,[Ja,t("div",Qa,[t("table",Xa,[eo,t("tbody",null,[(r(!0),l($,null,k(e.results,(p,i)=>(r(),l("tr",{key:i},[t("td",null,u(p.eventName),1),t("td",null,u(p.shortName),1),t("td",null,u(p.formattedStartDate),1),t("td",null,u(p.series),1),t("td",null,[p.final?(r(),x(o,{key:0,color:"red"})):g("",!0)]),t("td",null,[c(m,{to:{name:"edit-result",params:{resultid:p.raceid}}},{default:y(()=>[C("Edit")]),_:2},1032,["to"])]),t("td",null,[t("a",{href:`/#/result/${p.raceid}`,target:"_blank"},"View Output",8,to)]),so]))),128))])])])])):(r(),l("div",ao,ro))]))}const lo=v(Ha,[["render",no]]);const io={components:{},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},raceData:{}}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){if(this.error=null,this.loading=!0,this.$route.params.resultid)return b(`/api/results/${this.$route.params.resultid}`).then(e=>{this.raceData=e.data,this.loading=!1}).catch(e=>{this.raceData={},this.loading=!1,this.error=e.toString(),console.error(e)})},editCategories(){},editPaytypes(){},async saveRaceData(e){await b.patch(`/api/results/${this.raceData._id}`,this.formInputData).then(s=>{if(s.data)return console.log(s.data),this.fetchData()}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}},computed:{loaded(){return!!this.raceData}}},co={class:"container"},uo={key:0,class:"loading"},ho={key:1},mo={key:0,class:"error"},po={key:1},_o={class:"my-3"},fo=["href"],yo={class:"row"},go={class:"col-md-6"},bo={key:2},vo=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Result upload not found...")],-1),Co=[vo];function Do(e,s,d,h,a,n){const o=f("FormKit");return r(),l("div",co,[a.loading?(r(),l("div",uo,"Loading...")):(r(),l("div",ho,[a.error?(r(),l("div",mo,u(a.error),1)):g("",!0),a.raceData.raceid?(r(),l("div",po,[t("div",_o,[t("a",{href:`/#/result/${a.raceData.raceid}`},"View Result",8,fo)]),t("div",yo,[t("div",go,[c(o,{type:"form",errors:a.formError,id:"race-settings",onSubmit:n.saveRaceData,"submit-label":"Save",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=m=>a.formInputData=m)},{default:y(()=>{var m,p,i,D,R;return[c(o,{value:(m=a.raceData)==null?void 0:m.eventName,type:"text",name:"eventName",label:"Event Name"},null,8,["value"]),c(o,{value:(p=a.raceData)==null?void 0:p.shortName,type:"text",name:"shortName",label:"Short Name for series points column header"},null,8,["value"]),c(o,{value:(i=a.raceData)==null?void 0:i.formattedStartDate,type:"text",name:"formattedStartDate",label:"Display Date"},null,8,["value"]),c(o,{value:(D=a.raceData)==null?void 0:D.series,type:"text",name:"series",label:"series"},null,8,["value"]),c(o,{value:(R=a.raceData)==null?void 0:R.final,type:"checkbox",label:"Finalized - results cannot be updated via upload",name:"final"},null,8,["value"])]}),_:1},8,["errors","onSubmit","modelValue"])])])])):(r(),l("div",bo,Co))]))])}const $o=v(io,[["render",Do]]);const ko={components:{RouterLink:M,Check:U},data(){return{seriesOptions:!1,loading:!1,error:null}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{getSeriesResult(e){return _.find(this.results,{series:e})},fetchData(){if(this.error=null,this.loading=!0,this.$route)return b("/api/results/series/").then(e=>(this.results=e.data,this.loading=!1,this.getRaceResults())).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},getRaceResults(){return b("/api/results/").then(e=>{let s={};e.data.forEach(d=>{d.series&&(this.getSeriesResult(d.series)||(s[d.series]?s[d.series]+=1:s[d.series]=1))}),this.seriesOptions=s}).catch(e=>{console.error(e)})},async generateSeriesPoints(e){await b.post(`/api/results/series/${e}/generate`).then(s=>{if(s.data)return console.log(s.data),this.fetchData()})}},computed:{loaded(){return!!this.seriesOptions}}},Ro={key:0,class:"loading"},wo={key:1},xo={key:0,class:"error"},So={key:1},Eo=t("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},[t("h2",null,"Series Points Listings"),t("div",{class:"btn-toolbar mb-2 mb-md-0"})],-1),Lo={key:0,class:"table-responsive"},Po={class:"table table-striped table-hover table-sm"},No=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"series ID"),t("th",{scope:"col"},"Display Name"),t("th",{scope:"col"},"Published")])],-1),Vo=["href"],Io=["onClick"],Fo={key:1},Mo=t("h4",null,"No series points calculations found",-1),Oo=[Mo],Uo={key:2,class:"table-responsive"},To={class:"table table-striped table-hover table-sm"},Ko=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"series ID"),t("th",{scope:"col"},"number of results")])],-1),Bo=["onClick"],Ao={key:2},jo=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading results...")],-1),qo=[jo];function zo(e,s,d,h,a,n){const o=f("Check"),m=f("RouterLink");return a.loading?(r(),l("div",Ro,"Loading...")):(r(),l("div",wo,[a.error?(r(),l("div",xo,u(a.error),1)):g("",!0),n.loaded?(r(),l("div",So,[Eo,Object.keys(e.results).length?(r(),l("div",Lo,[t("table",Po,[No,t("tbody",null,[(r(!0),l($,null,k(e.results,(p,i)=>(r(),l("tr",null,[t("td",null,u(p.series),1),t("td",null,u(p.eventName),1),t("td",null,[p.published?(r(),x(o,{key:0,color:"green"})):g("",!0)]),t("td",null,[c(m,{to:{name:"edit-series-result",params:{series:p._id}}},{default:y(()=>[C("Edit")]),_:2},1032,["to"])]),t("td",null,[t("a",{href:`/#/result/series/${p.series}`,target:"_blank"},"view series points",8,Vo)]),t("td",null,[p.final?g("",!0):(r(),l("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:D=>n.generateSeriesPoints(p.series)}," Update Series Points ",8,Io))])]))),256))])])])):(r(),l("div",Fo,Oo)),Object.keys(a.seriesOptions).length?(r(),l("div",Uo,[t("table",To,[Ko,t("tbody",null,[(r(!0),l($,null,k(a.seriesOptions,(p,i)=>(r(),l("tr",null,[t("td",null,u(i),1),t("td",null,u(p),1),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:D=>n.generateSeriesPoints(i)}," Create Series Points ",8,Bo)])]))),256))])])])):g("",!0)])):(r(),l("div",Ao,qo))]))}const Ho=v(ko,[["render",zo]]);const Yo={components:{},data(){return{loading:!1,error:null,final:!1,formError:[],formInputData:{},data:{}}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){if(this.error=null,this.loading=!0,this.$route.params.series)return b(`/api/results/series/${this.$route.params.series}`).then(e=>{this.data=e.data,this.final=e.data.final,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},editCategories(){},editPaytypes(){},async saveRaceData(e){await b.patch(`/api/results/series/${this.data._id}`,e).then(s=>{if(s.data)return console.log(s.data),this.fetchData()}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}},computed:{loaded(){return!!this.raceData}}},Go={class:"container"},Wo={key:0,class:"loading"},Zo={key:1},Jo={key:0,class:"error"},Qo={key:1},Xo={class:"my-3"},er=["href"],tr={class:"row"},sr={class:"col-md-6"},ar={key:2},or=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Series Points record not found...")],-1),rr=[or];function nr(e,s,d,h,a,n){var m;const o=f("FormKit");return r(),l("div",Go,[a.loading?(r(),l("div",Wo,"Loading...")):(r(),l("div",Zo,[a.error?(r(),l("div",Jo,u(a.error),1)):g("",!0),(m=this.data)!=null&&m.series?(r(),l("div",Qo,[t("div",Xo,[t("a",{href:`/#/result/series/${a.data.series}`,target:"_blank"},"view series points",8,er)]),t("div",tr,[t("div",sr,[c(o,{type:"form",errors:a.formError,id:"season-pts-form",onSubmit:n.saveRaceData,"submit-label":"Save",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=p=>a.formInputData=p)},{default:y(()=>{var p,i;return[c(o,{value:(p=a.data)==null?void 0:p.eventName,type:"text",name:"eventName",label:"Event Name"},null,8,["value"]),c(o,{value:a.final,type:"checkbox",label:"Finalized - don't allow updates",name:"final"},null,8,["value"]),c(o,{value:(i=a.data)==null?void 0:i.published,type:"checkbox",label:"Published - will show on main index",name:"published"},null,8,["value"])]}),_:1},8,["errors","onSubmit","modelValue"])])])])):(r(),l("div",ar,rr))]))])}const lr=v(Yo,[["render",nr]]),ir=ue({history:he("/"),routes:[{path:"/payments/",component:gt,name:"payments"},{path:"/races/",component:Ka,name:"races"},{path:"/results/",component:lo,name:"results"},{path:"/series-results/",component:Ho,name:"series-results"},{path:"/edit-series-result/:series",component:lr,name:"edit-series-result"},{path:"/results/:resultid/",component:za,name:"view-result",children:[{path:"",component:$o,name:"edit-result"}]},{path:"/race/:raceid/",component:ya,name:"view-race",children:[{path:"",component:Us,name:"edit-race"},{path:"racers/",component:ds,name:"edit-racers"},{path:"series/:series",component:da,name:"edit-series-racers"}]}]});me.init({clientToken:"pub5b9b0cfce30b3b609b588d9f3ac85ebb",site:"datadoghq.com",env:"production",service:"admin-site",version:"1.0.1",forwardErrorsToLogs:!0,sampleRate:100});const T=pe(Ae);T.use(_e,fe);T.use(ir);T.mount("#app");
//# sourceMappingURL=admin-12ab96a5.js.map
