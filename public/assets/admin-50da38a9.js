import{_ as C,h as v,r as f,o as n,c as l,t as m,e as g,a as i,w as b,b as t,R as M,f as $,n as S,F as D,p as ie,g as ce,k as w,x as de,y as ae,T as ue,i as _,j as R,z as I,d as E,A as oe,B as O,l as me,m as he,q as pe,s as _e,u as fe,v as ye}from"./main-d2ef9e6b.js";const be={props:["message"],data(){return{errorMsg:[""]}},methods:{login(e){const{email:s,password:c}=e;return v.post("/api/auth/login",{email:s,password:c}).then(u=>{console.log(u),this.$emit("login"),this.$router.push({name:"races"})}).catch(u=>{u.response.status===401&&(this.errorMsg=["Invalid credentials, please try again"]),console.error(u)})}}},ge={class:"form-signin w-100 m-auto"},ve={key:0},Ce=t("h1",{class:"h3 mb-3 fw-normal"},"Sign in:",-1);function De(e,s,c,u,a,r){const o=f("FormKit");return n(),l("main",ge,[c.message?(n(),l("h3",ve,m(c.message),1)):g("",!0),Ce,i(o,{type:"form",onSubmit:r.login,errors:a.errorMsg},{default:b(()=>[i(o,{type:"email",name:"email",label:"Email address",validation:"","validation-visibility":"live"}),i(o,{type:"password",name:"password",label:"Password",validation:"required"})]),_:1},8,["onSubmit","errors"])])}const $e=C(be,[["render",De]]);const ke={emits:["logout"],components:{RouterView:M},data(){return{count:0}},computed:{}},re=e=>(ie("data-v-6a439c7e"),e=e(),ce(),e),Re={class:"navbar navbar-expand-md navbar-dark bg-dark fixed-top"},we={class:"container-fluid"},xe=re(()=>t("a",{class:"navbar-brand",href:"/"},"Signup.bike Admin",-1)),Se=re(()=>t("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarsExample04","aria-controls":"navbarsExample04","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),Ee={class:"collapse navbar-collapse",id:"navbarsExample04"},Ne={class:"navbar-nav me-auto mb-2 mb-md-0"},Le={class:"nav-item"},Pe={class:"nav-item"},Ve={class:"nav-item"},Ie={class:"nav-item"},Te={class:"container-fluid"};function Fe(e,s,c,u,a,r){const o=f("RouterLink"),h=f("RouterView");return n(),l(D,null,[t("nav",Re,[t("div",we,[xe,Se,t("div",Ee,[t("ul",Ne,[t("li",Le,[i(o,{class:S(["nav-link",{active:e.$route.name=="races"}]),to:{name:"races"}},{default:b(()=>[$(" Races ")]),_:1},8,["class"])]),t("li",Pe,[i(o,{class:S(["nav-link",{active:e.$route.name=="payments"}]),to:{name:"payments"}},{default:b(()=>[$(" Payments ")]),_:1},8,["class"])]),t("li",Ve,[i(o,{class:S(["nav-link",{active:e.$route.name=="results"}]),to:{name:"results"}},{default:b(()=>[$(" Results ")]),_:1},8,["class"])]),t("li",Ie,[i(o,{class:S(["nav-link",{active:e.$route.name=="series-results"}]),to:{name:"series-results"}},{default:b(()=>[$(" Series Points ")]),_:1},8,["class"])])]),t("button",{type:"button",class:"btn btn-secondary",onClick:s[0]||(s[0]=p=>e.$emit("logout"))},"Logout")])])]),t("body",null,[t("div",Te,[i(h)])])],64)}const Me=C(ke,[["render",Fe],["__scopeId","data-v-6a439c7e"]]);const Oe={components:{LoginComponent:$e,Manage:Me},data(){return{showLogin:!1,loginText:""}},created(){this.checkAuth()},methods:{hideLogin(){this.showLogin=!1},checkAuth(){if(console.log(this.$route.path),this.$route.path=="/login/")this.showLogin=!0;else return v.post("/api/auth/login",{}).then(e=>{console.log(e),this.showLogin=!1,!this.$route.path&&this.$router.push({name:"races"})}).catch(e=>{if(e.response.status===401)return this.showLogin=!0;console.error(e)})},logout(){return v.get("/api/auth/logout").then(e=>{console.log(e),this.showLogin=!0,this.loginText="You are logged out."})}}},Ue={key:0},Ke={class:"container"},Be={key:1};function Ae(e,s,c,u,a,r){const o=f("LoginComponent"),h=f("Manage");return a.showLogin?(n(),l("div",Ue,[t("div",Ke,[i(o,{onLogin:r.hideLogin,message:a.loginText},null,8,["onLogin","message"])])])):(n(),l("div",Be,[i(h,{onLogout:r.logout},null,8,["onLogout"])]))}const qe=C(Oe,[["render",Ae]]);const je={props:{show:Boolean}},ze={key:0,class:"modal-mask"},He={class:"modal-wrapper"},Ye={class:"modal-body"},Ge={class:"modal-footer"};function We(e,s,c,u,a,r){return n(),w(ue,{name:"modal"},{default:b(()=>[c.show?(n(),l("div",ze,[t("div",He,[t("div",{class:"modal-container",onKeydown:s[1]||(s[1]=de(o=>e.$emit("close"),["esc"])),tabIndex:"0"},[t("div",Ye,[ae(e.$slots,"body",{},()=>[$("default body")])]),t("div",Ge,[ae(e.$slots,"footer",{},()=>[t("button",{class:"btn btn-sm btn-danger modal-default-button",onClick:s[0]||(s[0]=o=>e.$emit("close"))},"Cancel")])])],32)])])):g("",!0)]),_:3})}const T=C(je,[["render",We]]),Ze={props:["paymentData","races","formMode"],data(){return{formError:[],formInputData:{},target:""}},mounted(){console.log(this.races),this.target=this.races[0]},computed:{raceOptions(){let e=this.races;return delete e[this.paymentData.regData.raceid],e}},methods:{async moveReg(e){return console.log(e),console.log(this.target),v.put("/api/payments/move-reg",{},{params:{paymentId:this.paymentData._id,raceId:this.target}}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})},async deleteReg(e){return console.log(e),console.log(this.target),v.delete(`/api/racers/race/${this.target}`,{params:{paymentId:this.paymentData._id}}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}}},Je=t("div",{class:"modal-header"},[t("h5",null," Edit Payment ")],-1);function Qe(e,s,c,u,a,r){const o=f("FormKit");return n(),l(D,null,[Je,t("div",null,[$(" Move This reg to Event: "),i(o,{type:"select",label:"Select an Event:",placeHolder:"Select race to transfer to",name:"selectedRace",modelValue:a.target,"onUpdate:modelValue":s[0]||(s[0]=h=>a.target=h),options:r.raceOptions},null,8,["modelValue","options"]),t("div",{class:"btn btn-sm btn-primary",onClick:s[1]||(s[1]=h=>r.moveReg())},"Transfer")]),t("div",null,[$(" Delete registration "),t("div",{class:"btn btn-sm btn-primary",onClick:s[2]||(s[2]=h=>r.deleteReg())},"Delete!")])],64)}const Xe=C(Ze,[["render",Qe]]);const et={components:{ModalComponent:T,EditPaymentComponent:Xe},data(){return{loading:!1,error:null,races:[],filterKey:"",filterPayStatus:"all",filterEvent:!1,filterPaytype:"all",payments:[],selectedRaceId:"",showModal:!1}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},watch:{selectedRaceId:{handler(e){this.getPaymentsForRace(this.selectedRaceId)},immediate:!0}},methods:{dollas(e){return _.isNumber(e)?parseFloat(e/100).toLocaleString("en-US",{style:"currency",currency:"USD"}):""},fetchData(){if(this.error=null,this.loading=!0,this.$route)return v("/api/races/").then(e=>{this.races=e.data,this.races.length>0&&(this.selectedRaceId=this.races[0].raceid),this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},getPaymentsForRace(e){e&&v(`/api/payments/${e}`).then(s=>{this.payments=s.data,this.loading=!1}).catch(s=>{this.loading=!1,this.error=s.toString(),console.error(s)})},editPayment(e){let s=_.clone(_.find(this.payments,{_id:e}));s?(console.log("payment Data:"),console.log(s),this.paymentToEdit=s,this.paymentFormMode="edit",this.showModal=!0):alert("no payment id found for racer")},closeModal(){this.showModal=!1}},computed:{loaded(){return!!this.payments},raceSelectOptions(){let e={};return _.each(this.races,({raceid:s,displayName:c})=>e[s]=c),e},seriesRaces(){let e=_.find(this.races,{raceid:this.selectedRaceId});if(console.log("race data"),console.log(e),!e||!e.series)return[];console.log("series races"),console.log();let s={};return _.each(_.filter(this.races,{series:e.series}),({raceid:c,displayName:u})=>s[c]=u),s},filterPayStatusOptions(){return{all:"All",unpaid:"unpaid",paid:"paid"}},filterPayTypeOptions(){return{all:"All",season:"Season",single:"Single"}},filteredPayments(){const e=this.filterKey&&this.filterKey.toLowerCase();return this.payments&&(e.length||this.filterPayStatus!=="all"||this.filterPaytype!=="all")?_.filter(this.payments,s=>{var c;return this.filterPayStatus!=="all"&&this.filterPayStatus!==s.status||this.filterPaytype!=="all"&&((c=s.regData)==null?void 0:c.paytype)!==this.filterPaytype?!1:parseInt(e)?parseInt(e)===parseInt(s.regData.bibNumber):["first_name","last_name"].some(u=>String(s.regData[u]).toLowerCase().indexOf(e)>-1)}):this.payments}}},tt={key:0,class:"loading"},st={key:1},at={key:0,class:"error"},ot={key:1},rt={class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},nt={class:"btn-toolbar mb-2 mb-md-0"},lt={class:"btn-toolbar mb-2 mb-md-0"},it={class:"btn-toolbar mb-2 mb-md-0"},ct={class:"btn-toolbar mb-2 mb-md-0"},dt=t("h2",null,"Payments",-1),ut={class:"table-responsive"},mt={class:"table table-striped table-hover table-sm"},ht=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Status"),t("th",{scope:"col"},"name"),t("th",{scope:"col"},"Reg Email"),t("th",{scope:"col"},"Race"),t("th",{scope:"col"},"Paytype")])],-1),pt=["href"],_t=["href"],ft=["onClick"],yt={key:2},bt=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading payments...")],-1),gt=[bt];function vt(e,s,c,u,a,r){const o=f("FormKit"),h=f("EditPaymentComponent"),p=f("modal-component");return a.loading?(n(),l("div",tt,"Loading...")):(n(),l("div",st,[a.error?(n(),l("div",at,m(a.error),1)):g("",!0),r.loaded?(n(),l("div",ot,[t("div",rt,[t("div",nt,[i(o,{type:"select",label:"Select an Event:",name:"selectedRace",modelValue:a.selectedRaceId,"onUpdate:modelValue":s[0]||(s[0]=d=>a.selectedRaceId=d),options:r.raceSelectOptions},null,8,["modelValue","options"])]),t("div",lt,[i(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last, bib number",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[1]||(s[1]=d=>a.filterKey=d)},null,8,["modelValue"])]),t("div",it,[i(o,{type:"select",label:"Filter by Status:",name:"filterPayStatus",modelValue:a.filterPayStatus,"onUpdate:modelValue":s[2]||(s[2]=d=>a.filterPayStatus=d),default:"all",options:r.filterPayStatusOptions},null,8,["modelValue","options"])]),t("div",ct,[i(o,{type:"select",label:"Filter by PayType:",name:"filterPaytype",modelValue:a.filterPaytype,"onUpdate:modelValue":s[3]||(s[3]=d=>a.filterPaytype=d),default:"all",options:r.filterPayTypeOptions},null,8,["modelValue","options"])])]),dt,t("div",ut,[t("table",mt,[ht,t("tbody",null,[(n(!0),l(D,null,R(r.filteredPayments,(d,y)=>{var k;return n(),l("tr",{key:y},[t("td",null,m(d.status),1),t("td",null,m(d.regData.first_name+" "+d.regData.last_name),1),t("td",null,[t("a",{href:`mailto:${d.regData.email}`},m(d.regData.email),9,pt)]),t("td",null,m(d.regData.paytype),1),t("td",null,m(r.dollas((k=d.stripePayment)==null?void 0:k.amount_total)),1),t("td",null,[t("a",{href:`/#/regconfirmation/${d.regData.raceid}/${d._id}`},"Reg Confirmation Page",8,_t)]),t("td",null,m(d.regData.bibNumber),1),t("td",null,[d.status!=="unpaid"&&d.regData.paytype!="season"?(n(),l("div",{key:0,class:"btn btn-sm btn-secondary",onClick:x=>r.editPayment(d._id)},"Edit",8,ft)):g("",!0)])])}),128))])]),(n(),w(I,{to:"body"},[a.payments.length>0?(n(),w(p,{key:0,show:a.showModal,onClose:r.closeModal},{body:b(()=>[i(h,{races:r.seriesRaces,paymentData:e.paymentToEdit,formMode:e.paymentFormMode},null,8,["races","paymentData","formMode"])]),_:1},8,["show","onClose"])):g("",!0)]))])])):(n(),l("div",yt,gt))]))}const Ct=C(et,[["render",vt]]);const Dt={props:{data:Array,columns:Array,filterKey:String,editIdColumn:String},emits:["edit"],data(){return{sortKey:"",sortOrders:this.columns.reduce((e,s)=>(e[s]=1,e),{})}},computed:{filteredData(){const e=this.sortKey,s=this.filterKey&&this.filterKey.toLowerCase(),c=this.sortOrders[e]||1;let u=this.data;return s&&(u=u.filter(a=>Object.keys(a).some(r=>String(a[r]).toLowerCase().indexOf(s)>-1))),e&&(u=u.slice().sort((a,r)=>(a=a[e],r=r[e],(a===r?0:a>r?1:-1)*c))),u}},methods:{sortBy(e){this.sortKey=e,this.sortOrders[e]=this.sortOrders[e]*-1},capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}}},$t={class:"table-responsive"},kt={key:0,class:"table table-striped table-sm"},Rt=["onClick"],wt={key:0},xt=["onClick"],St={key:1};function Et(e,s,c,u,a,r){return n(),l("div",$t,[r.filteredData.length?(n(),l("table",kt,[t("thead",null,[t("tr",null,[(n(!0),l(D,null,R(c.columns,o=>(n(),l("th",{onClick:h=>r.sortBy(o),class:S({active:a.sortKey==o})},[$(m(r.capitalize(o))+" ",1),t("span",{class:S(["arrow",a.sortOrders[o]>0?"asc":"dsc"])},null,2)],10,Rt))),256))])]),t("tbody",null,[(n(!0),l(D,null,R(r.filteredData,o=>(n(),l("tr",null,[(n(!0),l(D,null,R(c.columns,h=>(n(),l("td",null,m(o[h]),1))),256)),c.editIdColumn?(n(),l("td",wt,[t("div",{class:"btn btn-sm btn-outline-secondary",onClick:h=>e.$emit("edit",o[c.editIdColumn])},"edit",8,xt)])):g("",!0)]))),256))])])):(n(),l("p",St,"No data found."))])}const ne=C(Dt,[["render",Et]]);const Nt={props:["racerData","categories","payments","formMode","series"],emits:["saved"],data(){return{birthdate:"",formError:[],submitted:!1,paymentType:"season",prevBibError:[],formInputData:{}}},mounted(){if(this.formMode==="create"){this.paymentType=this.racerData.paytype;return}(this.formMode==="edit"||this.formMode==="regcash")&&(this.formInputData=this.racerData),_.defer(()=>{document.querySelector("#bibNumber").focus()})},computed:{sortedCats(){let e={};return _.forEach(_.orderBy(this.categories,"disporder"),s=>{e[s.id]=s.catdispname}),e},paymentOptions(){let e={};return _.forEach(this.payments,s=>{e[s.type]=s.name}),e.cash="Cash Single Entry",e.volunteer="Volunteer Single Entry",e.season="Season Comp",e},racerAge(){if(this.birthdate){const e=E(),s=E(this.birthdate);return e.year()-s.year()}},unpaidReg(){return this.formMode==="create"?this.paymentType=="cash":this.paymentType=="cash"&&this.racerData.status=="unpaid"},paymentAmount(){if(this.racerData.paytype==="cash")return _.find(this.payments,{type:"single"}).amount}},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},findPrevBib(e){v.post(`/api/racers/bib/${e}`,{series:`${this.series}`}).then(({data:s})=>{if(console.log("prevbib"),console.log(s),s.paytype==="season"){this.prevBibError=["Racer is already registered for the whole season"];return}s.prevPaymentId=s.paymentId,delete s.paymentId,delete s.paymentReceived,delete s.raceid,this.formInputData=s,this.prevAge=s.racerAge}).catch(({response:s})=>{console.dir(s),s.status==404&&(this.prevBibError=[s.data.message])})},onPrevBibChange(e){e?this.findPrevBib(e):(this.prevBibError=[],this.prevAge=null)},async submitHandler(e){console.log(e);let s;if(this.formMode==="create"||this.formMode==="regcash"){let c=this.paymentAmount;(e.paytype=="season"||e.paytype=="volunteer")&&(c=0,e.compedEntry=!0),s=v.post("/api/payments/register",{...e,paymentAmount:c},{params:{paymentId:e.paymentId,raceId:this.$route.params.raceid}})}else delete e.status,s=v.patch(`/api/racers/race/${this.$route.params.raceid}`,e,{params:{paymentId:this.racerData.paymentId}});return await s.then(c=>{if(c.data)return this.submitted=!0,console.log("response data"),console.log(c.data),new Promise(u=>setTimeout(()=>{this.$emit("saved"),u()},100))}).catch(c=>{this.formError=["Error submitting request"],console.log(c)})}}},Lt={class:"modal-header"},Pt={class:"edit-racer-form"},Vt={class:"double"},It={class:"double"},Tt={class:"double"},Ft={key:0},Mt=t("p",{class:"text-danger h4"},"Cash Payment Required",-1);function Ot(e,s,c,u,a,r){const o=f("FormKit");return n(),l(D,null,[t("div",Lt,[t("h5",null,m(c.racerData.status==="unpaid"?"Register Racer":"Edit Racer Data"),1)]),t("div",Pt,[c.formMode=="create"?(n(),w(o,{key:0,type:"number",name:"bibNumber",label:"Bib Number:",help:"Enter racer's bib number from a previous race",delay:1500,onInput:r.onPrevBibChange,errors:a.prevBibError},null,8,["onInput","errors"])):g("",!0),i(o,{type:"form",id:"admin-registration",modelValue:a.formInputData,"onUpdate:modelValue":s[1]||(s[1]=h=>a.formInputData=h),"form-class":a.submitted?"hide":"show",errors:a.formError,"submit-label":"Save",onSubmit:r.submitHandler},{default:b(()=>[t("div",Vt,[i(o,{type:"text",name:"first_name",label:"First name",validation:"required"}),i(o,{type:"text",name:"last_name",label:"Last name",validation:"required"})]),t("div",It,[i(o,{type:"email",name:"email",label:"Email",validation:"email"}),i(o,{type:"text",name:"sponsor",label:"Team or Sponsor"})]),i(o,{type:"text",name:"racerAge",label:"Racer Age",help:"age on dec 31"}),t("div",Tt,[i(o,{type:"select",id:"category",label:"Race Category:",placeholder:"Select a category",name:"category",options:r.sortedCats,validation:"required","validation-visibility":"dirty","validation-messages":{is:"You must select a race category"}},null,8,["options"]),i(o,{type:"select",id:"paytype",label:"Payment Type:",name:"paytype",options:r.paymentOptions,modelValue:a.paymentType,"onUpdate:modelValue":s[0]||(s[0]=h=>a.paymentType=h),validation:"required","validation-visibility":"dirty","validation-messages":{is:"You must select a Payment Type"}},null,8,["options","modelValue"])]),i(o,{id:"bibNumber",type:"text",name:"bibNumber",label:"Bib Number"}),r.unpaidReg?(n(),l("div",Ft,[Mt,i(o,{type:"checkbox",label:`I Collected ${r.dollas(r.paymentAmount)} from the racer`,name:"paymentReceived",validation:"required"},null,8,["label"])])):g("",!0)]),_:1},8,["modelValue","form-class","errors","onSubmit"])])],64)}const le=C(Nt,[["render",Ot]]);const Ut={components:{ModalComponent:T,RacerFormComponent:le,Grid:ne},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},data:{},racerToEdit:null,racerFormMode:"edit",showModal:!1,filterKey:"",filterUnpaid:!1,filterNoBib:!1,filterCats:"all"}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){this.error=null,this.loading=!0,this.$route.params.raceid&&v(`/api/racers/race/${this.$route.params.raceid}`).then(e=>{this.data=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},catName(e){let s=_.find(this.data.regCategories,{id:e});return s?s.catdispname:""},createReg(){this.racerToEdit={paytype:"cash",status:"unpaid",raceid:this.$route.params.raceid},this.racerFormMode="create",this.showModal=!0},regCash(e){let s=_.clone(_.find(this.data.registeredRacers,{paymentId:e}));s?(console.log("racerData:"),console.log(s),this.racerToEdit=s,this.racerFormMode="regcash",this.showModal=!0):alert("no payment id found for racer")},editRacer(e){let s=_.clone(_.find(this.data.registeredRacers,{paymentId:e}));s?(console.log("racerData:"),console.log(s),this.racerToEdit=s,this.racerFormMode="edit",this.showModal=!0):alert("no payment id found for racer")},racerUpdated(){this.racerToEdit=null,this.showModal=!1,this.fetchData()},capitalize(e){return _.capitalize(e)},closeModal(){this.showModal=!1,_.defer(()=>{document.querySelector("#racerFilterTxtInput").focus()})},resetFilters(){this.filterKey="",this.filterUnpaid=!1,this.filterNoBib=!1,this.filterCats="all"},optionalPurchases(e){if(!e)return"";let s="";return e.tshirt&&(s="shirt: "+e["tshirt-option"]),e.bottle&&(s+=" + Bottle"),s}},computed:{loaded(){return!!this.data},sortedCats(){let e={all:"All Categories"};return _.forEach(_.orderBy(this.data.regCategories,"disporder"),s=>{e[s.id]=s.catdispname}),e},filteredRacers(){const e=this.filterKey&&this.filterKey.toLowerCase();let s=this.data.registeredRacers;return(e.length||this.filterUnpaid||this.filterCats!=="all"||this.filterNoBib)&&(s=s.filter(c=>this.filterUnpaid&&c.status!=="unpaid"||this.filterNoBib&&c.bibNumber||this.filterCats!="all"&&c.category!=this.filterCats?!1:["first_name","last_name","bibNumber"].some(u=>String(c[u]).toLowerCase().indexOf(e)>-1))),_.sortBy(s,[function(c){return c.last_name.toLowerCase()}])}}},Kt={key:0,class:"loading"},Bt={key:1},At={key:0,class:"error"},qt={key:1,class:"container-fluid"},jt={class:"d-flex flex-row justify-content-center"},zt={class:"p-2"},Ht={class:"racer-controls d-flex flex-row justify-content-between flex-wrap align-items-top pb-2 mb-3 border-bottom"},Yt={class:"p-2"},Gt={class:"flex-grow-1 p-2"},Wt={class:"d-flex flex-row search-checks"},Zt={class:"d-flex flex-grow-1 justify-content-between p-2 pt-4"},Jt={class:"table-responsive"},Qt={class:"table table-striped table-sm"},Xt=t("th",{scope:"col"},"First Name",-1),es=t("th",{scope:"col"},"Last Name",-1),ts=t("th",{scope:"col"},"Category",-1),ss=t("th",{scope:"col"},"Bib Number",-1),as=t("th",{scope:"col"},"Purchases",-1),os=t("th",{scope:"col"},"Paytype",-1),rs=t("th",{scope:"col"},"Payment Status",-1),ns={scope:"col"},ls=["onClick"],is=["onClick"],cs={key:2},ds=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Race not available for registration...")],-1),us=[ds];function ms(e,s,c,u,a,r){const o=f("FormKit"),h=f("RacerFormComponent"),p=f("modal-component");return a.loading?(n(),l("div",Kt,"Loading...")):(n(),l("div",Bt,[a.error?(n(),l("div",At,m(a.error),1)):g("",!0),r.loaded?(n(),l("div",qt,[t("div",jt,[t("div",zt,[t("h3",null,m(a.data.displayName),1)])]),t("div",Ht,[t("div",Yt,[i(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last or bib number",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[0]||(s[0]=d=>a.filterKey=d)},null,8,["modelValue"])]),t("div",Gt,[i(o,{type:"select",name:"categories",label:"Filter by Category",options:r.sortedCats,modelValue:a.filterCats,"onUpdate:modelValue":s[1]||(s[1]=d=>a.filterCats=d)},null,8,["options","modelValue"]),t("div",Wt,[i(o,{type:"checkbox",name:"unpaid",label:"Unpaid Only",modelValue:a.filterUnpaid,"onUpdate:modelValue":s[2]||(s[2]=d=>a.filterUnpaid=d)},null,8,["modelValue"]),i(o,{type:"checkbox",name:"noBib",label:"No Bib Only",modelValue:a.filterNoBib,"onUpdate:modelValue":s[3]||(s[3]=d=>a.filterNoBib=d)},null,8,["modelValue"])])]),t("div",Zt,[t("a",{class:"btn btn-primary align-self-start",onClick:s[4]||(s[4]=(...d)=>r.resetFilters&&r.resetFilters(...d))},"Reset Filters"),t("div",{class:"btn btn-md btn-success align-self-start",onClick:s[5]||(s[5]=d=>r.createReg())},"Add New Registration")])]),t("div",Jt,[t("table",Qt,[t("thead",null,[t("tr",null,[Xt,es,ts,ss,as,os,rs,t("th",ns,[t("strong",null,m(r.filteredRacers.length)+" Found",1)])])]),t("tbody",null,[(n(!0),l(D,null,R(r.filteredRacers,(d,y)=>(n(),l("tr",{key:y},[t("td",null,m(d.first_name),1),t("td",null,m(d.last_name),1),t("td",null,m(r.catName(d.category)),1),t("td",null,m(d.bibNumber),1),t("td",null,m(r.optionalPurchases(d.optionalPurchases)),1),t("td",null,m(d.paytype),1),t("td",{class:S({"text-success":d.status!=="unpaid","text-danger":d.status==="unpaid"})},m(r.capitalize(d.status)),3),t("td",null,[d.status!=="unpaid"?(n(),l("div",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:k=>r.editRacer(d.paymentId)},m("edit"),8,ls)):g("",!0),d.status==="unpaid"?(n(),l("div",{key:1,class:"btn btn-sm btn-outline-secondary",onClick:k=>r.regCash(d.paymentId)},m("Register"),8,is)):g("",!0)])]))),128))])]),(n(),w(I,{to:"body"},[i(p,{show:a.showModal,onClose:r.closeModal},{body:b(()=>[i(h,{onSaved:r.racerUpdated,racerData:a.racerToEdit,categories:a.data.regCategories,payments:a.data.paymentOptions,formMode:a.racerFormMode,series:a.data.series},null,8,["onSaved","racerData","categories","payments","formMode","series"])]),_:1},8,["show","onClose"])]))])])):(n(),l("div",cs,us))]))}const hs=C(Ut,[["render",ms]]);const ps={components:{},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},raceData:{}}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){if(this.error=null,this.loading=!0,this.$route.params.raceid)return v(`/api/races/${this.$route.params.raceid}`).then(e=>{this.raceData=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},editCategories(){},editPaytypes(){},async saveRaceData(e){await v.patch(`/api/races/${this.$route.params.raceid}`,this.formInputData).then(s=>{if(s.data)return console.log(s.data),this.fetchData()}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}},computed:{sortedCats(){return _.orderBy(this.raceData.regCategories,"disporder")},loaded(){return!!this.raceData},eventDate(){return E(this.raceData.eventDate).format("YYYY-MM-DDTHH:mm")},regOpenDate(){return E(this.raceData.regOpenDate).format("YYYY-MM-DDTHH:mm")},timeToOpen(){var e;return E().to((e=this.raceData.eventDetails)==null?void 0:e.regOpenDate)},timeToClose(){var e;return E().to((e=this.raceData.eventDetails)==null?void 0:e.regCloseDate)},paymentOptions(){let e={};return _.forEach(this.raceData.paymentOptions,s=>{e[s.type]=s.name}),e}}},_s={class:"container"},fs={key:0,class:"loading"},ys={key:1},bs={key:0,class:"error"},gs={key:1},vs={class:"my-3"},Cs=["href"],Ds={class:"my-3"},$s=["href"],ks={class:"row"},Rs={class:"col-md-6"},ws={class:"col-md-6"},xs={class:"col-md mb-3"},Ss=t("h5",null,"Categories",-1),Es={class:"row g-2 px-4 gx-4 border bg-light"},Ns={class:"my-1"},Ls={key:0},Ps={class:"col-md mb-3"},Vs=t("h5",null,"Payment Options",-1),Is={class:"row g-2 px-4 gx-4 border bg-light"},Ts={class:"my-1"},Fs={class:"col-md mb-3"},Ms=t("h5",null,"Coupons",-1),Os={class:"row g-2 px-4 gx-4 border bg-light"},Us={class:"my-1"};function Ks(e,s,c,u,a,r){const o=f("FormKit");return n(),l("div",_s,[a.loading?(n(),l("div",fs,"Loading...")):(n(),l("div",ys,[a.error?(n(),l("div",bs,m(a.error),1)):g("",!0),(n(),l("div",gs,[t("div",vs,[t("a",{href:`/#/register/${a.raceData.raceid}`},"View Reg Form",8,Cs)]),t("div",Ds,[t("a",{href:`/#/roster/${a.raceData.raceid}`},"View Roster",8,$s)]),t("div",ks,[t("div",Rs,[i(o,{type:"form",errors:a.formError,id:"race-settings",onSubmit:r.saveRaceData,"submit-label":"Save",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=h=>a.formInputData=h)},{default:b(()=>{var h,p,d,y,k,x,N,B;return[i(o,{value:(h=a.raceData)==null?void 0:h.displayName,type:"text",name:"displayName",label:"Event Name"},null,8,["value"]),i(o,{value:r.eventDate,type:"datetime-local",name:"eventDate",label:"Date"},null,8,["value"]),i(o,{value:(p=a.raceData)==null?void 0:p.series,type:"text",name:"series",label:"Event Series Name"},null,8,["value"]),i(o,{value:(d=a.raceData)==null?void 0:d.seriesRaceNumber,type:"number",name:"seriesRaceNumber",label:"Series Race Number"},null,8,["value"]),i(o,{type:"group",name:"eventDetails"},{default:b(()=>{var L,P,A,q,j,z,H,Y,G,W,Z,J,Q,X;return[i(o,{value:(P=(L=a.raceData)==null?void 0:L.eventDetails)==null?void 0:P.name,type:"text",name:"name",label:"Header Event Name"},null,8,["value"]),i(o,{value:(q=(A=a.raceData)==null?void 0:A.eventDetails)==null?void 0:q.formattedDates,type:"text",name:"formattedDates",label:"Header Formatted dates"},null,8,["value"]),i(o,{value:(z=(j=a.raceData)==null?void 0:j.eventDetails)==null?void 0:z.tagline,type:"text",name:"tagline",label:"Header tagline text"},null,8,["value"]),i(o,{value:(Y=(H=a.raceData)==null?void 0:H.eventDetails)==null?void 0:Y.regOpenDate,type:"datetime-local",name:"regOpenDate",label:"Registration Open Date"},null,8,["value"]),t("p",null,"Registration Opens "+m(r.timeToOpen),1),i(o,{value:(W=(G=a.raceData)==null?void 0:G.eventDetails)==null?void 0:W.regCloseDate,type:"datetime-local",name:"regCloseDate",label:"Registration Close Date"},null,8,["value"]),t("p",null,"Registration Closes "+m(r.timeToClose),1),i(o,{value:(J=(Z=a.raceData)==null?void 0:Z.eventDetails)==null?void 0:J.logoUrl,type:"text",name:"logoUrl",label:"Logo URL"},null,8,["value"]),i(o,{value:(X=(Q=a.raceData)==null?void 0:Q.eventDetails)==null?void 0:X.homepageUrl,type:"text",name:"homepageUrl",label:"Home Page URL"},null,8,["value"]),i(o,{type:"group",name:"facebookShare"},{default:b(()=>{var ee,te,se;return[i(o,{value:(se=(te=(ee=a.raceData)==null?void 0:ee.eventDetails)==null?void 0:te.facebookShare)==null?void 0:se.url,type:"text",name:"url",label:"FB Share URL"},null,8,["value"])]}),_:1})]}),_:1}),i(o,{type:"textarea",value:(y=a.raceData)==null?void 0:y.headerContent,"v-model":(k=a.raceData)==null?void 0:k.headerContent,label:"Extra content below header",name:"headerContent"},null,8,["value","v-model"]),i(o,{value:(x=a.raceData)==null?void 0:x.entryCountMax,type:"number",label:"Maximum Number of registrations",name:"entryCountMax"},null,8,["value"]),t("p",null,[t("h6",null,"Current Reg Count: "+m(a.raceData.entryCount),1)]),i(o,{value:(N=a.raceData)==null?void 0:N.showPaytypeOnRoster,type:"checkbox",label:"Show Payment Type as stages on roster",name:"showPaytypeOnRoster"},null,8,["value"]),i(o,{value:a.raceData.isTestData,type:"checkbox",label:"Use Test payment integrations",name:"isTestData"},null,8,["value"]),i(o,{value:a.raceData.couponsEnabled,type:"checkbox",label:"Enable Coupons",name:"couponsEnabled"},null,8,["value"]),i(o,{value:(B=a.raceData)==null?void 0:B.cashPaymentsEnabled,type:"checkbox",label:"Enable Cash payments on race day",name:"cashPaymentsEnabled"},null,8,["value"]),i(o,{type:"group",name:"stripeMeta"},{default:b(()=>{var L,P;return[i(o,{value:(P=(L=a.raceData)==null?void 0:L.stripeMeta)==null?void 0:P.accountId,type:"text",name:"accountId",label:"Stripe Integration Account ID"},null,8,["value"])]}),_:1}),i(o,{value:a.raceData.archived,type:"checkbox",label:"Archive Race (will not be visible in admin race list)",name:"archived"},null,8,["value"])]}),_:1},8,["errors","onSubmit","modelValue"])]),t("div",ws,[t("div",xs,[Ss,t("div",Es,[(n(!0),l(D,null,R(r.sortedCats,h=>(n(),l("div",Ns,[$(m(h.catdispname)+" ",1),h.sponsored?(n(),l("strong",Ls,"Sponsored")):g("",!0)]))),256))])]),i(o,{type:"button",onClick:r.editCategories},{default:b(()=>[$(" Edit Categories ")]),_:1},8,["onClick"]),t("div",Ps,[Vs,t("div",Is,[(n(!0),l(D,null,R(a.raceData.paymentOptions,h=>(n(),l("div",Ts,m(h.name)+":"+m(`  ${r.dollas(h.amount)}`),1))),256))])]),i(o,{type:"button",onClick:r.editPaytypes},{default:b(()=>[$(" Edit Paytypes ")]),_:1},8,["onClick"]),t("div",Fs,[Ms,t("div",Os,[(n(!0),l(D,null,R(a.raceData.coupons,h=>(n(),l("div",Us,m(e.payOpt.name)+":"+m(`  ${r.dollas(e.payOpt.amount)}`),1))),256))])]),i(o,{type:"button",onClick:r.editPaytypes},{default:b(()=>[$(" Edit Paytypes ")]),_:1},8,["onClick"])])])]))]))])}const Bs=C(ps,[["render",Ks]]);const As={components:{ModalComponent:T,RacerFormComponent:le,Grid:ne},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},data:{},racerToEdit:null,showModal:!1,filterKey:"",filterUnpaid:!1,filterNoBib:!1,filterCats:"all",filterSimilar:!0}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){this.error=null,this.loading=!0,this.$route.params.raceid&&this.$route.params.series&&v(`/api/racers/series/${this.$route.params.series}`).then(({data:e})=>{console.log(e),this.data={registeredRacers:e.racers,regCategories:e.regCategories,races:e.races},this.loading=!1,this.error=""}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)}),this.error="invalid URL"},catName(e){let s=_.find(this.data.regCategories,{id:e});return s?s.catdispname:""},createReg(){this.racerToEdit={paytype:"cash",status:"unpaid",raceid:this.$route.params.raceid},this.showModal=!0},editRacer(e){let s=_.clone(_.find(this.data.registeredRacers,{paymentId:e}));s?(this.racerToEdit=s,this.showModal=!0):alert("no payment id found for racer")},racerUpdated(){this.racerToEdit=null,this.showModal=!1,this.fetchData()},capitalize(e){return _.capitalize(e)},closeModal(){this.showModal=!1,_.defer(()=>{document.querySelector("#racerFilterTxtInput").focus()})},resetFilters(){this.filterKey="",this.filterUnpaid=!1,this.filterNoBib=!1,this.filterCats="all"}},computed:{loaded(){return!!this.data},sortedCats(){let e={all:"All Categories"};return _.forEach(_.orderBy(this.data.regCategories,"disporder"),s=>{e[s.id]=s.catdispname}),e},filteredRacers(){const e=this.filterKey&&this.filterKey.toLowerCase();let s=this.data.registeredRacers;if(this.filterSimilar){let c=[];return _.forEach(this.data.races,(u,a)=>{console.log(u);let r=_.filter(s,{raceid:u});_.forEach(r,(o,h)=>{_.forEach(_.filter(s,{raceid:this.data.races[a+1]}),p=>{(o.first_name.toLowerCase()===p.first_name.toLowerCase()||o.last_name.toLowerCase()===p.last_name.toLowerCase())&&(_.includes(c,o)||c.push(o),_.includes(c,p)||c.push(p))})})}),_.sortBy(c,[function(u){return u.last_name.toLowerCase()}])}return(e.length||this.filterUnpaid||this.filterCats!=="all"||this.filterNoBib)&&(s=s.filter(c=>this.filterUnpaid&&c.status!=="unpaid"||this.filterNoBib&&c.bibNumber||this.filterCats!="all"&&c.category!=this.filterCats?!1:["first_name","last_name","bibNumber"].some(u=>String(c[u]).toLowerCase().indexOf(e)>-1))),_.sortBy(s,[function(c){return c.last_name.toLowerCase()}])}}},qs={key:0,class:"loading"},js={key:1},zs={key:0,class:"error"},Hs={key:1,class:"container-fluid"},Ys={class:"racer-controls d-flex flex-row justify-content-between flex-wrap align-items-top pt-3 pb-2 mb-3 p-2 border-bottom"},Gs={class:"p-2"},Ws={class:"flex-grow-1 p-2"},Zs={class:"d-flex flex-row search-checks"},Js={class:"d-flex flex-grow-1 justify-content-between pt-4"},Qs={class:"table-responsive"},Xs={class:"table table-striped table-sm"},ea=t("th",{scope:"col"},"First Name",-1),ta=t("th",{scope:"col"},"Last Name",-1),sa=t("th",{scope:"col"},"Email",-1),aa=t("th",{scope:"col"},"Category",-1),oa=t("th",{scope:"col"},"Bib Number",-1),ra=t("th",{scope:"col"},"Paytype",-1),na=t("th",{scope:"col"},"EventName",-1),la={scope:"col"},ia=["onClick"],ca={key:2},da=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Race not available for registration...")],-1),ua=[da];function ma(e,s,c,u,a,r){const o=f("FormKit"),h=f("RacerFormComponent"),p=f("modal-component");return a.loading?(n(),l("div",qs,"Loading...")):(n(),l("div",js,[a.error?(n(),l("div",zs,m(a.error),1)):g("",!0),r.loaded?(n(),l("div",Hs,[t("div",Ys,[t("div",Gs,[i(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last or bib number",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[0]||(s[0]=d=>a.filterKey=d)},null,8,["modelValue"])]),t("div",Ws,[i(o,{type:"select",name:"categories",label:"Filter by Category",options:r.sortedCats,modelValue:a.filterCats,"onUpdate:modelValue":s[1]||(s[1]=d=>a.filterCats=d)},null,8,["options","modelValue"]),t("div",Zs,[i(o,{type:"checkbox",name:"unpaid",label:"Unpaid Only",modelValue:a.filterUnpaid,"onUpdate:modelValue":s[2]||(s[2]=d=>a.filterUnpaid=d)},null,8,["modelValue"]),i(o,{type:"checkbox",name:"noBib",label:"No Bib Only",modelValue:a.filterNoBib,"onUpdate:modelValue":s[3]||(s[3]=d=>a.filterNoBib=d)},null,8,["modelValue"]),i(o,{type:"checkbox",name:"duplicates",label:"Duplicates",modelValue:a.filterSimilar,"onUpdate:modelValue":s[4]||(s[4]=d=>a.filterSimilar=d)},null,8,["modelValue"])])]),t("div",Js,[t("a",{class:"btn btn-primary align-self-start",onClick:s[5]||(s[5]=(...d)=>r.resetFilters&&r.resetFilters(...d))},"Reset Filters")])]),t("div",Qs,[t("table",Xs,[t("thead",null,[t("tr",null,[ea,ta,sa,aa,oa,ra,na,t("th",la,[t("strong",null,m(r.filteredRacers.length)+" Found",1)])])]),t("tbody",null,[(n(!0),l(D,null,R(r.filteredRacers,(d,y)=>(n(),l("tr",{key:y},[t("td",null,m(d.first_name),1),t("td",null,m(d.last_name),1),t("td",null,m(d.email),1),t("td",null,m(r.catName(d.category)),1),t("td",null,m(d.bibNumber),1),t("td",null,m(d.paytype),1),t("td",null,m(d.eventDisplayName),1),t("td",null,[t("div",{class:"btn btn-sm btn-outline-secondary",onClick:k=>r.editRacer(d.paymentId)},m("edit"),8,ia)])]))),128))])]),(n(),w(I,{to:"body"},[i(p,{show:a.showModal,onClose:r.closeModal},{body:b(()=>[i(h,{onSaved:r.racerUpdated,racerData:a.racerToEdit,categories:a.data.regCategories,payments:a.data.paymentOptions,formMode:"edit",series:a.data.series},null,8,["onSaved","racerData","categories","payments","series"])]),_:1},8,["show","onClose"])]))])])):(n(),l("div",ca,ua))]))}const ha=C(As,[["render",ma]]),pa={props:["races"],components:{RouterView:M},data(){return{count:0}},computed:{}},_a={class:"container-fluid"},fa={class:"nav nav-tabs"},ya={class:"nav-item"},ba={class:"nav-item"};function ga(e,s,c,u,a,r){const o=f("RouterLink"),h=f("RouterView");return n(),l("div",_a,[t("ul",fa,[t("li",ya,[i(o,{class:S(["nav-link",{active:e.$route.name=="edit-race"}]),to:{name:"edit-race"}},{default:b(()=>[$(" Event Settings ")]),_:1},8,["class"])]),t("li",ba,[i(o,{class:S(["nav-link",{active:e.$route.name=="edit-racers"}]),to:{name:"edit-racers"}},{default:b(()=>[$(" Event Registrations ")]),_:1},8,["class"])])]),i(h)])}const va=C(pa,[["render",ga]]),V={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Ca=["size","color"];function F(){return F=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&(e[u]=c[u])}return e},F.apply(this,arguments)}function Da(e,s){if(e==null)return{};var c={},u=Object.keys(e),a,r;for(r=0;r<u.length;r++)a=u[r],!(s.indexOf(a)>=0)&&(c[a]=e[a]);return c}var $a=function(s){return s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()},ka=function(s,c){return function(u,a){var r=u.size,o=u.color,h=Da(u,Ca),p=a.attrs;a.emit;var d=a.slots;return oe("svg",F({},V,{width:r||V.width,height:r||V.height,stroke:o||V.stroke},p,{class:["lucide","lucide-"+$a(s),(p==null?void 0:p.class)||""]},h),[].concat(c.map(function(y){return oe.apply(void 0,y)}),d.default?[d.default()]:[]))}};const Ra=ka;var wa=Ra("CheckIcon",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]);const U=wa;const xa={components:{RouterLink:O,Check:U},data(){return{loading:!1,error:null}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{fetchData(){if(this.error=null,this.loading=!0,this.$route)return v("/api/races/").then(e=>{this.raceData=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})}},computed:{loaded(){return!!this.raceData}}},Sa={key:0,class:"loading"},Ea={key:1},Na={key:0,class:"error"},La={key:1},Pa=t("h2",null,"Active Races",-1),Va={class:"table-responsive"},Ia={class:"table table-striped table-hover table-sm"},Ta=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Name"),t("th",{scope:"col"},"series ID"),t("th",null,"Test Payments")])],-1),Fa=["href"],Ma=["href"],Oa=["href"],Ua={key:2},Ka=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading races...")],-1),Ba=[Ka];function Aa(e,s,c,u,a,r){const o=f("RouterLink"),h=f("Check");return a.loading?(n(),l("div",Sa,"Loading...")):(n(),l("div",Ea,[a.error?(n(),l("div",Na,m(a.error),1)):g("",!0),r.loaded?(n(),l("div",La,[Pa,t("div",Va,[t("table",Ia,[Ta,t("tbody",null,[(n(!0),l(D,null,R(e.raceData,(p,d)=>(n(),l("tr",{key:d},[t("td",null,[i(o,{to:{name:"edit-racers",params:{raceid:p.raceid}}},{default:b(()=>[$(m(p.displayName),1)]),_:2},1032,["to"])]),t("td",null,m(p.series),1),t("td",null,[p.isTestData?(n(),w(h,{key:0,color:"orange"})):g("",!0)]),t("td",null,[t("a",{href:`/#/register/${p.raceid}`},"Goto Reg Form",8,Fa)]),t("td",null,[t("a",{class:"btn btn-sm btn-secondary mx-1",href:`/api/racers/race/${p.raceid}/export-contact`},"Contact List",8,Ma),t("a",{class:"btn btn-sm btn-secondary mx-1",href:`/api/racers/race/${p.raceid}/export`},"export",8,Oa)])]))),128))])])])])):(n(),l("div",Ua,Ba))]))}const qa=C(xa,[["render",Aa]]),ja={components:{RouterView:M},data(){return{count:0}},computed:{}},za={class:"container-fluid"},Ha=t("ul",{class:"nav nav-tabs"},null,-1);function Ya(e,s,c,u,a,r){const o=f("RouterView");return n(),l("div",za,[Ha,i(o)])}const Ga=C(ja,[["render",Ya]]);const Wa={components:{RouterLink:O,Check:U},data(){return{loading:!1,error:null}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{fetchData(){if(this.error=null,this.loading=!0,this.$route)return v("/api/results/").then(e=>{this.results=e.data,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})}},computed:{loaded(){return!!this.results}}},Za={key:0,class:"loading"},Ja={key:1},Qa={key:0,class:"error"},Xa={key:1},eo=t("h2",null,"Race Result Uploads",-1),to={class:"table-responsive"},so={class:"table table-striped table-hover table-sm"},ao=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Event Name"),t("th",{scope:"col"},"Series Points Display Name"),t("th",{scope:"col"},"Formatted Date"),t("th",{scope:"col"},"series ID"),t("th",{scope:"col"},"Finalized")])],-1),oo=["href"],ro=t("td",null,null,-1),no={key:2},lo=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading results...")],-1),io=[lo];function co(e,s,c,u,a,r){const o=f("Check"),h=f("RouterLink");return a.loading?(n(),l("div",Za,"Loading...")):(n(),l("div",Ja,[a.error?(n(),l("div",Qa,m(a.error),1)):g("",!0),r.loaded?(n(),l("div",Xa,[eo,t("div",to,[t("table",so,[ao,t("tbody",null,[(n(!0),l(D,null,R(e.results,(p,d)=>(n(),l("tr",{key:d},[t("td",null,m(p.eventName),1),t("td",null,m(p.shortName),1),t("td",null,m(p.formattedStartDate),1),t("td",null,m(p.series),1),t("td",null,[p.final?(n(),w(o,{key:0,color:"red"})):g("",!0)]),t("td",null,[i(h,{to:{name:"edit-result",params:{resultid:p.raceid}}},{default:b(()=>[$("Edit")]),_:2},1032,["to"])]),t("td",null,[t("a",{href:`/#/result/${p.raceid}`,target:"_blank"},"View Output",8,oo)]),ro]))),128))])])])])):(n(),l("div",no,io))]))}const uo=C(Wa,[["render",co]]);const mo={components:{},data(){return{categories:{},loading:!1,error:null,formError:[],formInputData:{},raceData:{}}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){if(this.error=null,this.loading=!0,this.$route.params.resultid)return v(`/api/results/${this.$route.params.resultid}`).then(e=>{this.raceData=e.data,this.loading=!1}).catch(e=>{this.raceData={},this.loading=!1,this.error=e.toString(),console.error(e)})},editCategories(){},editPaytypes(){},async saveRaceData(e){await v.patch(`/api/results/${this.raceData._id}`,this.formInputData).then(s=>{if(s.data)return console.log(s.data),this.fetchData()}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}},computed:{loaded(){return!!this.raceData}}},ho={class:"container"},po={key:0,class:"loading"},_o={key:1},fo={key:0,class:"error"},yo={key:1},bo={class:"my-3"},go=["href"],vo={class:"row"},Co={class:"col-md-6"},Do={key:2},$o=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Result upload not found...")],-1),ko=[$o];function Ro(e,s,c,u,a,r){const o=f("FormKit");return n(),l("div",ho,[a.loading?(n(),l("div",po,"Loading...")):(n(),l("div",_o,[a.error?(n(),l("div",fo,m(a.error),1)):g("",!0),a.raceData.raceid?(n(),l("div",yo,[t("div",bo,[t("a",{href:`/#/result/${a.raceData.raceid}`},"View Result",8,go)]),t("div",vo,[t("div",Co,[i(o,{type:"form",errors:a.formError,id:"race-settings",onSubmit:r.saveRaceData,"submit-label":"Save",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=h=>a.formInputData=h)},{default:b(()=>{var h,p,d,y,k,x;return[i(o,{value:(h=a.raceData)==null?void 0:h.eventName,type:"text",name:"eventName",label:"Event Name"},null,8,["value"]),i(o,{value:(p=a.raceData)==null?void 0:p.shortName,type:"text",name:"shortName",label:"Short Name for series points column header"},null,8,["value"]),i(o,{value:(d=a.raceData)==null?void 0:d.formattedStartDate,type:"text",name:"formattedStartDate",label:"Display Date"},null,8,["value"]),i(o,{value:(y=a.raceData)==null?void 0:y.series,type:"text",name:"series",label:"series"},null,8,["value"]),i(o,{value:(k=a.raceData)==null?void 0:k.showMillis,type:"checkbox",label:"Show milliseconds on times",name:"showMillis"},null,8,["value"]),i(o,{value:(x=a.raceData)==null?void 0:x.final,type:"checkbox",label:"Finalized - results cannot be updated via upload",name:"final"},null,8,["value"])]}),_:1},8,["errors","onSubmit","modelValue"])])])])):(n(),l("div",Do,ko))]))])}const wo=C(mo,[["render",Ro]]);const xo={components:{RouterLink:O,Check:U},data(){return{seriesOptions:!1,loading:!1,error:null}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData()},{immediate:!0})},methods:{getSeriesResult(e){return _.find(this.results,{series:e})},fetchData(){if(this.error=null,this.loading=!0,this.$route)return v("/api/results/series/").then(e=>(this.results=e.data,this.loading=!1,this.getRaceResults())).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},getRaceResults(){return v("/api/results/").then(e=>{let s={};e.data.forEach(c=>{c.series&&(this.getSeriesResult(c.series)||(s[c.series]?s[c.series]+=1:s[c.series]=1))}),this.seriesOptions=s}).catch(e=>{console.error(e)})},async generateSeriesPoints(e){await v.post(`/api/results/series/${e}/generate`).then(s=>{if(s.data)return console.log(s.data),this.fetchData()})}},computed:{loaded(){return!!this.seriesOptions}}},So={key:0,class:"loading"},Eo={key:1},No={key:0,class:"error"},Lo={key:1},Po=t("div",{class:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"},[t("h2",null,"Series Points Listings"),t("div",{class:"btn-toolbar mb-2 mb-md-0"})],-1),Vo={key:0,class:"table-responsive"},Io={class:"table table-striped table-hover table-sm"},To=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"series ID"),t("th",{scope:"col"},"Display Name"),t("th",{scope:"col"},"Published")])],-1),Fo=["href"],Mo=["onClick"],Oo={key:1},Uo=t("h4",null,"No series points calculations found",-1),Ko=[Uo],Bo={key:2,class:"table-responsive"},Ao={class:"table table-striped table-hover table-sm"},qo=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"series ID"),t("th",{scope:"col"},"number of results")])],-1),jo=["onClick"],zo={key:2},Ho=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Error loading results...")],-1),Yo=[Ho];function Go(e,s,c,u,a,r){const o=f("Check"),h=f("RouterLink");return a.loading?(n(),l("div",So,"Loading...")):(n(),l("div",Eo,[a.error?(n(),l("div",No,m(a.error),1)):g("",!0),r.loaded?(n(),l("div",Lo,[Po,Object.keys(e.results).length?(n(),l("div",Vo,[t("table",Io,[To,t("tbody",null,[(n(!0),l(D,null,R(e.results,(p,d)=>(n(),l("tr",null,[t("td",null,m(p.series),1),t("td",null,m(p.eventName),1),t("td",null,[p.published?(n(),w(o,{key:0,color:"green"})):g("",!0)]),t("td",null,[i(h,{to:{name:"edit-series-result",params:{series:p._id}}},{default:b(()=>[$("Edit")]),_:2},1032,["to"])]),t("td",null,[t("a",{href:`/#/result/series/${p.series}`,target:"_blank"},"view series points",8,Fo)]),t("td",null,[p.final?g("",!0):(n(),l("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:y=>r.generateSeriesPoints(p.series)}," Update Series Points ",8,Mo))])]))),256))])])])):(n(),l("div",Oo,Ko)),Object.keys(a.seriesOptions).length?(n(),l("div",Bo,[t("table",Ao,[qo,t("tbody",null,[(n(!0),l(D,null,R(a.seriesOptions,(p,d)=>(n(),l("tr",null,[t("td",null,m(d),1),t("td",null,m(p),1),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:y=>r.generateSeriesPoints(d)}," Create Series Points ",8,jo)])]))),256))])])])):g("",!0)])):(n(),l("div",zo,Yo))]))}const Wo=C(xo,[["render",Go]]);const Zo={props:["racerData","series"],emits:["saved"],data(){return{formError:[],submitted:!1,formInputData:{}}},mounted(){this.formInputData=this.racerData},computed:{},methods:{async submitHandler(e){console.log(e);let s;return s=v.post(`/api/team-comp/racers/?series=${this.series}`,e),await s.then(c=>{if(c.data)return this.submitted=!0,console.log("response data"),console.log(c.data),new Promise(u=>setTimeout(()=>{this.$emit("saved"),u()},100))}).catch(c=>{this.formError=["Error submitting request"],console.log(c)})}}},Jo=t("div",{class:"modal-header"},[t("h5",null," Team Competition Info ")],-1),Qo={class:"edit-racer-form"},Xo={class:"double"};function er(e,s,c,u,a,r){const o=f("FormKit");return n(),l(D,null,[Jo,t("div",Qo,[i(o,{type:"form",id:"admin-registration",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=h=>a.formInputData=h),"form-class":a.submitted?"hide":"show",errors:a.formError,"submit-label":"Save",onSubmit:r.submitHandler},{default:b(()=>[t("div",Xo,[i(o,{type:"number",name:"Bib",label:"Bib Number"}),i(o,{type:"text",name:"Name",label:"Name",validation:"required"}),i(o,{type:"text",name:"Sponsor",label:"Team Name"}),i(o,{type:"text",name:"Cat",label:"Category"})])]),_:1},8,["modelValue","form-class","errors","onSubmit"])])],64)}const tr=C(Zo,[["render",er]]);const sr={components:{ModalComponent:T,TeamRacerFormComponent:tr},data(){return{loading:!1,error:null,final:!1,filterKey:"",formError:[],formInputData:{},teamRacerToAdd:{},data:{},showModal:!1}},created(){this.$watch(()=>this.$route.params,()=>{this.fetchData(),this.fetchTeamCompRacers()},{immediate:!0})},methods:{dollas(e){return typeof e=="string"&&(e=parseInt(e)),e.toLocaleString("en-US",{style:"currency",currency:"USD"})},fetchData(){if(this.error=null,this.loading=!0,this.$route.params.series)return v(`/api/results/series/${this.$route.params.series}`).then(e=>{this.data=e.data,this.final=e.data.final,this.loading=!1}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},fetchTeamCompRacers(){return v(`/api/team-comp/racers/?series=${this.$route.params.series}`).then(e=>{this.teamRacers=e.data}).catch(e=>{this.loading=!1,this.error=e.toString(),console.error(e)})},async updateTeamCompRacer(e){console.log(e),this.teamRacerToAdd=e,this.showModal=!0},teamRacerUpdated(){this.teamRacerToAdd={},this.closeModal()},closeModal(){this.showModal=!1},async saveRaceData(e){await v.patch(`/api/results/series/${this.data._id}`,e).then(s=>{if(s.data)return console.log(s.data),this.fetchData()}).catch(s=>{this.formError=["Error submitting request"],console.log(s)})}},computed:{loaded(){return!!this.raceData},hasTeamComp(){var e,s;return((s=(e=this.data)==null?void 0:e.teamCompDates)==null?void 0:s.length)>1},teamCompRacers(){var e;if(this.hasTeamComp){let s=[];return Object.keys((e=this.data)==null?void 0:e.categories).forEach(c=>{let u=this.data.categories[c],a=u.catdispname;u.results.forEach(r=>{let o={Name:r.Name,Bib:r.Bib,Cat:a,Sponsor:r.Sponsor};s.push(o)})}),this.filterKey&&(s=s.filter(c=>c.Name.toLowerCase().indexOf(this.filterKey.toLowerCase())>-1||c.Bib==parseInt(this.filterKey))),s}}}},ar={class:"container"},or={key:0,class:"loading"},rr={key:1},nr={key:0,class:"error"},lr={key:1},ir={class:"my-3"},cr=["href"],dr={class:"row"},ur={class:"col-md-6"},mr={key:0,class:"col-md-6"},hr=t("h5",null,"Racers",-1),pr={class:"btn-toolbar mb-2 mb-md-0"},_r={class:"row"},fr={class:"col"},yr=["onClick"],br={class:"col"},gr={class:"col"},vr={class:"col"},Cr={key:2},Dr=t("div",{class:"text-center"},[t("h2",{class:"mt-5"},"Series Points record not found...")],-1),$r=[Dr];function kr(e,s,c,u,a,r){var d;const o=f("FormKit"),h=f("TeamRacerFormComponent"),p=f("modal-component");return n(),l("div",ar,[a.loading?(n(),l("div",or,"Loading...")):(n(),l("div",rr,[a.error?(n(),l("div",nr,m(a.error),1)):g("",!0),(d=this.data)!=null&&d.series?(n(),l("div",lr,[t("div",ir,[t("a",{href:`/#/result/series/${a.data.series}`,target:"_blank"},"view series points",8,cr)]),t("div",dr,[t("div",ur,[i(o,{type:"form",errors:a.formError,id:"season-pts-form",onSubmit:r.saveRaceData,"submit-label":"Save",modelValue:a.formInputData,"onUpdate:modelValue":s[0]||(s[0]=y=>a.formInputData=y)},{default:b(()=>{var y,k,x,N;return[i(o,{value:(y=a.data)==null?void 0:y.eventName,type:"text",name:"eventName",label:"Event Name"},null,8,["value"]),i(o,{value:(k=a.data)==null?void 0:k.gromRaceDates,type:"text",name:"gromRaceDates",label:"Grom Race Dates"},null,8,["value"]),i(o,{value:(x=a.data)==null?void 0:x.teamCompDates,type:"text",name:"teamCompDates",label:"Team Competition Race Dates"},null,8,["value"]),i(o,{value:a.final,type:"checkbox",label:"Finalized - don't allow updates",name:"final"},null,8,["value"]),i(o,{value:(N=a.data)==null?void 0:N.published,type:"checkbox",label:"Published - will show on main index",name:"published"},null,8,["value"])]}),_:1},8,["errors","onSubmit","modelValue"])]),r.hasTeamComp?(n(),l("div",mr,[hr,t("div",null,[t("div",pr,[i(o,{id:"racerFilterTxtInput",type:"text",name:"search",label:"Search:",help:"search in first, last, bib",delay:300,modelValue:a.filterKey,"onUpdate:modelValue":s[1]||(s[1]=y=>a.filterKey=y)},null,8,["modelValue"])])]),t("div",null,[(n(!0),l(D,null,R(r.teamCompRacers,y=>(n(),l("div",_r,[t("div",fr,[t("div",{class:"btn btn-sm btn-primary",onClick:k=>r.updateTeamCompRacer(y)},"Add",8,yr)]),t("div",br,m(y.Name),1),t("div",gr,m(y.Bib),1),t("div",vr,m(y.Sponsor),1)]))),256))])])):g("",!0)]),(n(),w(I,{to:"body"},[i(p,{show:a.showModal,onClose:r.closeModal},{body:b(()=>[i(h,{onSaved:r.teamRacerUpdated,racerData:a.teamRacerToAdd,series:a.data.series},null,8,["onSaved","racerData","series"])]),_:1},8,["show","onClose"])]))])):(n(),l("div",Cr,$r))]))])}const Rr=C(sr,[["render",kr]]),wr=me({history:he("/"),routes:[{path:"/payments/",component:Ct,name:"payments"},{path:"/races/",component:qa,name:"races"},{path:"/results/",component:uo,name:"results"},{path:"/series-results/",component:Wo,name:"series-results"},{path:"/edit-series-result/:series",component:Rr,name:"edit-series-result"},{path:"/results/:resultid/",component:Ga,name:"view-result",children:[{path:"",component:wo,name:"edit-result"}]},{path:"/race/:raceid/",component:va,name:"view-race",children:[{path:"",component:Bs,name:"edit-race"},{path:"racers/",component:hs,name:"edit-racers"},{path:"series/:series",component:ha,name:"edit-series-racers"}]}]});pe.init({clientToken:"pub5b9b0cfce30b3b609b588d9f3ac85ebb",site:"datadoghq.com",env:"production",service:"admin-site",version:"1.0.1",forwardErrorsToLogs:!0,sampleRate:100});const K=_e(qe);K.use(fe,ye);K.use(wr);K.mount("#app");
//# sourceMappingURL=admin-50da38a9.js.map
